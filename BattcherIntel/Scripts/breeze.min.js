(function(n){typeof exports=="object"?module.exports=n():typeof define=="function"?define(n):breeze=n()})(function(){function it(n,t){for(var i in n)lt(n,i)&&t(i,n[i])}function br(n,t){var i,r;for(i in n)if(lt(n,i)&&(r=n[i],t(i,r)))return{key:i,value:r};return null}function fr(n,t){var u=[],i,r;for(i in n)lt(n,i)&&(r=t?t(i,n[i]):n[i],r!==undefined&&u.push(r));return u}function pi(n,t){return function(i){return i[n]===t}}function bt(n){return function(t){return t[n]}}function kr(n){var t=[];for(var i in n)lt(n,i)&&t.push(n[i]);return t}function h(n,t,i){if(!t)return n;if(i)i.forEach(function(i){n[i]=t[i]});else for(var r in t)lt(t,r)&&(n[r]=t[r]);return n}function wi(n,t){for(var i in t)n[i]===undefined&&(n[i]=t[i]);return n}function ui(n,t){return t.defaultInstance=wi(new t(n),t.defaultInstance),n}function kt(n,t){var f={},r,i,u;for(r in t)r in n&&(i=n[r],u=t[r],i!=u)&&(Array.isArray(i)&&i.length===0||(typeof u=="function"?i=u(i):typeof i=="object"&&i&&i.parentEnum&&(i=i.name),i!==undefined)&&(f[r]=i));return f}function dt(n,t){var r,u,f,i;if(n!==Object(n))return n;if(n._$visited)return undefined;if(n.toJSON){if(r=n.toJSON(),r!==Object(r))return r;if(r!==n)return dt(r);n=r}if(n._$visited=!0,n instanceof Array)u=n.map(function(n){return dt(n,t)});else if(typeof n=="function")u=undefined;else{u={};for(f in n)f!=="_$visited"&&((i=n[f],t&&(i=t(f,i),i===undefined))||(i=dt(i),i!==undefined)&&(u[f]=i))}return delete n._$visited,u}function dr(n,t){var i={},r=n.length;return t.forEach(function(t){for(var f,e,u=0;u<r;u++)if(f=n[u],f&&(e=f[t],e!==undefined)){i[t]=e;break}}),i}function b(n){return n==null?[]:Array.isArray(n)?n:[n]}function bi(n,t){if(n==null)return n;var i;return Array.isArray(n)?(i=[],n.map(function(n,r){i[r]=t(n,r)})):i=t(n),i}function nt(n,t){for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return n[i];return null}function er(n,t){for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return i;return-1}function or(n,t,i){for(var f=gi(t)?t:undefined,e=n.length-1,u=!1,r=e;r>=0;r--)if((f?f(n[r]):n[r]===t)&&(n.splice(r,1),u=!0,!i))return u;return u}function ki(n,t,i){for(var u=[],f=Math.min(n.length,t.length),r=0;r<f;++r)u.push(i(n[r],t[r]));return u}function sr(n,t,i){if(!n||!t||n.length!==t.length)return!1;for(var r=0;r<n.length;r++)if(Array.isArray(n[r])){if(!sr(n[r],t[r]))return!1}else if(i){if(!i(n[r],t[r]))return!1}else if(n[r]!==t[r])return!1;return!0}function di(n,t){var i=n[t];return i||(i=[],n[t]=i),i}function hu(n,t){for(var r,u=n.split(";"),i=0,f=u.length;i<f;i++)if(r=hr(u[i]),r)return r;if(t)throw new Error("Unable to initialize "+n+".  "+t||"");}function hr(n){function r(n,t){if(n)return n.defined&&!n.defined(t)?void 0:n(t)}var t,i;try{if(this.window)return(i=this.window,t=i[n],t)?t:r(i.require,n);t=r(require,n)}catch(u){}return t}function gt(n,t,i,r){var u=n[t];if(i===u)return r();n[t]=i;try{return r()}finally{u===undefined?delete n[t]:n[t]=u}}function gr(n,t,i){var r;try{return r=n(),i()}catch(u){typeof r=="object"&&(r.error=u);throw u;}finally{t(r)}}function nu(n){return function(){for(var r=d(arguments),i="",u=r.length,t=null;u--;)t=r[u],i+=t===Object(t)?JSON.stringify(t):t,n.memoize||(n.memoize={});return i in n.memoize?n.memoize[i]:n.memoize[i]=n.apply(this,r)}}function fi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}function tu(n){var r,t,i;if(typeof n!="string")throw new Error("Invalid ISO8601 duration '"+n+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(n),!r)throw new Error("Invalid ISO8601 duration '"+n+"'");var f=[2,3,4,6,7,8],e=[31104e3,2592e3,86400,3600,60,1],u=0;for(t=0;t<6;t++)i=r[f[t]],i=i?+i.replace(/[A-Za-z]+/g,""):0,u+=i*e[t];return u}function iu(n){return n===null?"null":n===undefined?"undefined":Object.prototype.toString.call(n).slice(8,-1).toLowerCase()}function at(n){return iu(n)==="date"&&!isNaN(n.getTime())}function gi(n){return iu(n)==="function"}function nr(n){return typeof n=="string"&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(n)}function tr(n){return typeof n=="string"&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(n)}function ft(n){if(n===null||n===undefined)return!0;for(var t in n)if(lt(n,t))return!1;return!0}function cu(n){return!isNaN(parseFloat(n))&&isFinite(n)}function vt(n,t){return!n||!t?!1:n.indexOf(t,0)===0}function cr(n,t){return!n||!t?!1:n.indexOf(t,n.length-t.length)!==-1}function p(n){var t=arguments,i=RegExp("%([1-"+(arguments.length-1)+"])","g");return n.replace(i,function(n,i){return t[i]})}function ru(n){var t=Function.call;return function(){return t.apply(n,arguments)}}function au(n,t,i){var f,c,k,v,d,r,st,ht,ct,w,h,rt,lt,y,b,ut,ft,at,et,vt,yt,nt;if(t===undefined&&(t=null),f=i(),c=n.dataType,c&&c.parse&&(t=Array.isArray(t)&&!n.isScalar?t.map(function(n){return c.parse(n,typeof n)}):c.parse(t,typeof t)),t!==f&&(!c||!c.isDate||!t||!f||t.valueOf()!==f.valueOf())){var ot=this,tt=n.name,a,l,s,e=this.entityAspect;if(e)a=e;else if(a=this.complexAspect,a)e=a.getEntityAspect();else{i(t);return}if(k=a.getPropertyPath(tt),v=e._inProcess,v){if(v.indexOf(n)>=0)return;v.push(n)}else v=[n],e._inProcess=v;d=e.entity;try{if(r=e.entityManager,e.entityState.isUnchangedOrModified()&&a.originalValues[tt]===undefined&&n.isDataProperty&&!n.isComplexProperty&&(a.originalValues[tt]=f!==undefined?f:n.defaultValue),n.isComplexProperty)if(n.isScalar){if(!t)throw new Error(p("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",n.name,n.dataType.name));f||(st=c.getCtor(),f=new st,i(f));c.dataProperties.forEach(function(n){var i=n.name,r=t.getProperty(i);f.setProperty(i,r)})}else throw new Error(p("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",n.name,n.parentType.name));else if(n.isDataProperty){if(!n.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(n.isPartOfKey&&!this.complexAspect&&r&&!r.isLoading){var pt=this.entityType.keyProperties,wt=pt.map(function(i){return i===n?t:this.getProperty(i.name)},this),it=new o(this.entityType,wt);if(r.findEntityByKey(it))throw new Error("An entity with this key is already in the cache: "+it.toString());ht=this.entityAspect.getKey();ct=r._findEntityGroup(this.entityType);ct._replaceKey(ht,it)}w=n.relatedNavigationProperty;w&&r?t!=null?(l=new o(w.entityType,[t]),s=r.findEntityByKey(l),s?this.setProperty(w.name,s):r._unattachedChildrenMap.addChild(l,w,this)):this.setProperty(w.name,null):n.inverseNavigationProperty&&r&&!r._inKeyFixup&&(h=n.inverseNavigationProperty,f!=null&&(l=new o(h.parentType,[f]),s=r.findEntityByKey(l),s&&(h.isScalar?s.setProperty(h.name,null):(rt=s.getProperty(h.name),rt.splice(rt.indexOf(this),1)))),t!=null&&(l=new o(h.parentType,[t]),s=r.findEntityByKey(l),s?h.isScalar?s.setProperty(h.name,this):s.getProperty(h.name).push(this):r._unattachedChildrenMap.addChild(l,h,this)));i(t);r&&!r.isLoading&&(e.entityState.isUnchanged()&&!n.isUnmapped&&e.setModified(),r.validationOptions.validateOnPropertyChange&&e._validateProperty(t,{entity:d,property:n,propertyName:k,oldValue:f}));n.isPartOfKey&&!this.complexAspect&&(lt=this.entityType.keyProperties.indexOf(n),this.entityType.navigationProperties.forEach(function(n){var u=n.inverse,f=u?u.foreignKeyNames:n.invForeignKeyNames,i,r;if(f.length!==0)if(i=ot.getProperty(n.name),r=f[lt],n.isScalar){if(!i)return;i.setProperty(r,t)}else i.forEach(function(n){n.setProperty(r,t)})}),e.getKey(!0))}else{if(!n.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");if(y=n.inverse,t!=null)if(b=t.entityAspect,r){if(b.entityState.isDetached())r.isLoading||r.attachEntity(t,u.Added);else if(b.entityManager!==r)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.");}else b&&b.entityManager&&(r=b.entityManager,r.isLoading||r.attachEntity(e.entity,u.Added));y?y.isScalar?(f!=null&&f.setProperty(y.name,null),t!=null&&t.setProperty(y.name,this)):(f!=null&&(ut=f.getProperty(y.name),ft=ut.indexOf(this),ft!==-1&&ut.splice(ft,1)),t!=null&&(at=t.getProperty(y.name),at.push(this))):n.invForeignKeyNames&&r&&!r._inKeyFixup&&(et=n.invForeignKeyNames,t!=null?(vt=this.entityAspect.getKey().values,et.forEach(function(n,i){t.setProperty(n,vt[i])})):f!=null&&et.forEach(function(n){var t=f.entityType.getProperty(n);t.isPartOfKey||f.setProperty(n,null)}));i(t);r&&!r.isLoading&&(e.entityState.isUnchanged()&&!n.isUnmapped&&e.setModified(),r.validationOptions.validateOnPropertyChange&&e._validateProperty(t,{entity:this,property:n,propertyName:k,oldValue:f}));n.relatedDataProperties&&(e.entityState.isDeleted()||(yt=n.entityType.keyProperties,yt.forEach(function(i,r){var u=n.relatedDataProperties[r],f;(t||!u.isPartOfKey)&&(f=t?t.getProperty(i.name):u.defaultValue,ot.setProperty(u.name,f))})))}nt={entity:d,parent:this,property:n,propertyName:k,oldValue:f,newValue:t};r?r.isLoading||r.isRejectingChanges||(e.propertyChanged.publish(nt),r.entityChanged.publish({entityAction:g.PropertyChange,entity:d,args:nt})):e.propertyChanged.publish(nt)}finally{v.pop()}}}function fu(n){return n.indexOf(":#")>=0}function si(n,t){return n+":#"+t}function lr(n,t,i){var r,u,f;if(t)if(Array.isArray(t))t.forEach(n.addProperty.bind(n));else if(typeof t=="object")for(r in t)lt(t,r)&&(u=t[r],u.name=r,f=new i(u),n.addProperty(f));else throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");}function ur(n,t){var r,i,u;if(r=Array.isArray(t)?t:t.split("."),r.length===1)return n.getProperty(t);for(i=n,u=0;u<r.length;u++)if(i=i.getProperty(r[u]),i==null)break;return i}function eu(n){return n&&n.isDate?function(n){return n&&n.getTime()}:n===i.Time?function(n){return n&&tu(n)}:function(n){return n}}var t={version:"1.4.7",metadataVersion:"1.0.5"},lt=ru(Object.prototype.hasOwnProperty),d=ru(Array.prototype.slice),r,et,tt,y,ni,ii,g,ot,ei,o,u,i,c,oi,f,ar,hi,ci,ou,pr,wr,wt,su;Object.create||(Object.create=function(n){var t=function(){};return t.prototype=n,new t});r={};r.objectForEach=it;r.extend=h;r.propEq=pi;r.pluck=bt;r.arrayEquals=sr;r.arrayFirst=nt;r.arrayIndexOf=er;r.arrayRemoveItem=or;r.arrayZip=ki;r.requireLib=hu;r.using=gt;r.memoize=nu;r.getUuid=fi;r.durationToSeconds=tu;r.isDate=at;r.isGuid=nr;r.isDuration=tr;r.isFunction=gi;r.isEmpty=ft;r.isNumeric=cu;r.stringStartsWith=vt;r.stringEndsWith=cr;r.formatString=p;r.toJSONSafe=dt;r.parent=t;t.core=r;var ir=function(){function f(n,t){return t==null?!1:typeof t=="string"&&t.length>0}function e(n,t){return t==null?!1:typeof t===n.typeName?!0:!1}function o(n,t){return t==null?!1:t instanceof n.type}function s(n,t){return t==null?!1:t[n.propertyName]!==undefined}function c(n,t){return t==null?!1:n.enumType.contains(t)}function l(n,t){return n.allowNull?t!==undefined:t!=null}function a(n,t){if(t==null)return!0;var i=n.prevContext;return i?i.fn(i,t):!0}function v(n,t){var r=n.prevContext,u=r?" or it "+i(r,t):"";return"is optional"+u}function y(n,t){if(!Array.isArray(t)||n.mustNotBeEmpty&&t.length===0)return!1;var i=n.prevContext;return i?t.every(function(n){return i.fn(i,n)}):!0}function w(n,t){var u=n.mustNotBeEmpty?"a nonEmpty array":"an array",r=n.prevContext,f=r?" where each element "+i(r,t):"";return" must be "+u+f}function i(n,t){var i=n.msg;return typeof i=="function"&&(i=i(n,t)),i}function t(n,t){if(n._context){for(var i=n._context;i.prevContext!=null;)i=i.prevContext;if(i.prevContext===null)return i.prevContext=t,n;if(t.prevContext===null)t.prevContext=n._context;else throw new Error("Illegal construction - use 'or' to combine checks");}return b(n,t)}function b(n,t){return n._contexts[n._contexts.length-1]=t,n._context=t,n}function k(n){var t=n._contexts;return(t[t.length-1]==null&&t.pop(),t.length===0)?undefined:t.some(function(t){return t.fn(t,n.v)})}function u(n,t){throw new Error(p("Error configuring an instance of '%1'. %2",n&&n._$typeName||"object",t));}var r=function(n,t){this.v=n;this.name=t;this._contexts=[null]},n=r.prototype;return n.isObject=function(){return this.isTypeOf("object")},n.isBoolean=function(){return this.isTypeOf("boolean")},n.isString=function(){return this.isTypeOf("string")},n.isNonEmptyString=function(){return t(this,{fn:f,msg:"must be a nonEmpty string"})},n.isNumber=function(){return this.isTypeOf("number")},n.isFunction=function(){return this.isTypeOf("function")},n.isTypeOf=function(n){return t(this,{fn:e,typeName:n,msg:p("must be a '%1'",n)})},n.isInstanceOf=function(n,i){return i=i||n.prototype._$typeName,t(this,{fn:o,type:n,typeName:i,msg:p("must be an instance of '%1'",i)})},n.hasProperty=function(n){return t(this,{fn:s,propertyName:n,msg:p("must have a '%1' property ",n)})},n.isEnumOf=function(n){return t(this,{fn:c,enumType:n,msg:p("must be an instance of the '%1' enumeration",n.name)})},n.isRequired=function(n){return t(this,{fn:l,allowNull:n,msg:"is required"})},n.isOptional=function(){var n={fn:a,prevContext:null,msg:v};return t(this,n)},n.isNonEmptyArray=function(){return this.isArray(!0)},n.isArray=function(n){var i={fn:y,mustNotBeEmpty:n,prevContext:null,msg:w};return t(this,i)},n.or=function(){return this._contexts.push(null),this._context=null,this},n.check=function(n){var t=k(this);if(t!==undefined){if(!t)throw new Error(this.getMessage());return this.v!==undefined?this.v:n}},n._addContext=function(n){return t(this,n)},n.getMessage=function(){var n=this,t=this._contexts.map(function(t){return i(t,n.v)}).join(", or it ");return p(this.MESSAGE_PREFIX,this.name)+" "+t},n.withDefault=function(n){return this.defaultValue=n,this},n.whereParam=function(n){return this.parent.whereParam(n)},n.applyAll=function(n,t,i){var e=n._$typeName,r,f;if(i=i||e&&this.parent.config._$typeName===e,r=h({},this.parent.config),this.parent.params.forEach(function(f){i||delete r[f.name];try{f.check()}catch(e){u(n,e.message)}t||f._applyOne(n)}),!i)for(f in r)r[f]!==undefined&&u(n,p("Unknown property: '%1'.",f))},n._applyOne=function(n){this.v!==undefined?n[this.name]=this.v:this.defaultValue!==undefined&&(n[this.name]=this.defaultValue)},n.MESSAGE_PREFIX="The '%1' parameter ",r}(),n=function(n,t){return new ir(n,t)},lu=function(){var n=function(n){if(typeof n!="object")throw new Error("Configuration parameter should be an object, instead it is a: "+typeof n);this.config=n;this.params=[]},t=n.prototype;return t.whereParam=function(n){var t=new ir(this.config[n],n);return t.parent=this,this.params.push(t),t},n}(),s=function(n){return new lu(n)};r.Param=ir;r.assertParam=n;r.assertConfig=s;et=function(){function t(){}var i=function(n,i){this.name=n;var r=new t(i);r.parentEnum=this;this._symbolPrototype=r;i&&Object.keys(i).forEach(function(n){r[n]=i[n]})},n=i.prototype;return i.isSymbol=function(n){return n instanceof t},n.fromName=function(n){return this[n]},n.addSymbol=function(n){var t=Object.create(this._symbolPrototype);return n&&Object.keys(n).forEach(function(i){t[i]=n[i]}),setTimeout(function(){t.getName()},0),t},n.seal=function(){this.getSymbols().forEach(function(n){return n.getName()})},n.getSymbols=function(){return this.getNames().map(function(n){return this[n]},this)},n.getNames=function(){var t=[];for(var n in this)this.hasOwnProperty(n)&&(n==="name"||n.substr(0,1)==="_"||gi(this[n])||t.push(n));return t},n.contains=function(n){return(n instanceof t)?this[n.getName()]===n:!1},t.prototype.getName=function(){if(!this.name){var n=this;this.name=nt(this.parentEnum.getNames(),function(t){return n.parentEnum[t]===n})}return this.name},t.prototype.toString=function(){return this.getName()},t.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},i}();r.Enum=et;tt=function(){function u(n,t,i){var r=n._subscribers;if(!r)return!0;r.forEach(function(r){try{r.callback(t)}catch(u){u.context="unable to publish on topic: "+n.name;i?i(u):n._defaultErrorCallback?n._defaultErrorCallback(u):e(u)}})}function e(){}var f={},r=1,t=function(t,i,r){n(t,"eventName").isNonEmptyString().check();n(i,"publisher").isObject().check();this.name=t;f[t]=!0;this.publisher=i;r&&(this._defaultErrorCallback=r)},i=t.prototype;return i.publish=function(n,i,r){return t._isEnabled(this.name,this.publisher)?(i===!0?setTimeout(u,0,this,n,r):u(this,n,r),!0):!1},i.publishAsync=function(n,t){this.publish(n,!0,t)},i.subscribe=function(n){this._subscribers||(this._subscribers=[]);var t=r;return this._subscribers.push({unsubKey:t,callback:n}),++r,t},i.unsubscribe=function(n){if(!this._subscribers)return!1;var t=this._subscribers,i=er(t,function(t){return t.unsubKey===n});return i!==-1?(t.splice(i,1),t.length===0&&(this._subscribers=null),!0):!1},i.clear=function(){this._subscribers=null},t.bubbleEvent=function(n,t){n._getEventParent=t},t.enable=function(t,i,r){n(t,"eventName").isNonEmptyString().check();n(i,"obj").isObject().check();n(r,"isEnabled").isBoolean().isOptional().or().isFunction().check();i._$eventMap||(i._$eventMap={});i._$eventMap[t]=r},t.isEnabled=function(i,r){if(n(i,"eventName").isNonEmptyString().check(),n(r,"obj").isObject().check(),!r._getEventParent)throw new Error("This object does not support event enabling/disabling");return t._isEnabled(r,i)},t._isEnabled=function(n,i){var r=null,f=i._$eventMap,u;return f&&(r=f[n]),r!=null?typeof r=="function"?r(i):!!r:(u=i._getEventParent&&i._getEventParent(),u?t._isEnabled(n,u):!0)},t}();r.Event=tt;y=function(){function u(n,i,r){var u=i.defaultInstance;return u||(u=new i.ctor,i.defaultInstance=u,u._$impl=i),u.initialize(),r&&(n.defaultInstance=u),t.interfaceInitialized.publish({interfaceName:n.name,instance:u,isDefault:!0}),u.checkForRecomposition&&t.interfaceInitialized.subscribe(function(n){u.checkForRecomposition(n)}),u}function r(n){var r=n.toLowerCase(),i=br(t.interfaceRegistry||{},function(n){return n.toLowerCase()===r});if(!i)throw new Error("Unknown interface name: "+n);return i.value}var t={},i;return t.functionRegistry={},t.typeRegistry={},t.objectRegistry={},t.interfaceInitialized=new tt("interfaceInitialized",t),i=function(n){this.name=n;this.defaultInstance=null;this._implMap={}},i.prototype.registerCtor=function(n,t){this._implMap[n.toLowerCase()]={ctor:t,defaultInstance:null}},i.prototype.getImpl=function(n){return this._implMap[n.toLowerCase()]},i.prototype.getFirstImpl=function(){var n=br(this._implMap,function(){return!0});return n?n.value:null},t.interfaceRegistry={ajax:new i("ajax"),modelLibrary:new i("modelLibrary"),dataService:new i("dataService")},t.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},t.setProperties=function(n){s(n).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(n);n.remoteAccessImplementation&&t.initializeAdapterInstance("dataService",n.remoteAccessImplementation);n.trackingImplementation&&t.initializeAdapterInstance("modelLibrary",n.trackingImplementation);n.ajaxImplementation&&t.initializeAdapterInstance("ajax",n.ajaxImplementation)},t.registerAdapter=function(t,i){var f,u,e;if(n(t,"interfaceName").isNonEmptyString().check(),n(i,"adapterCtor").isFunction().check(),f=new i,u=f.name,!u)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");e=r(t);e.registerCtor(u,i)},t.getAdapter=function(n,t){var i=r(n),u;return t?(u=i.getImpl(t),u?u.ctor:null):i.defaultInstance?i.defaultInstance._$impl.ctor:null},t.initializeAdapterInstances=function(n){return s(n).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().applyAll(this,!1),fr(n,t.initializeAdapterInstance)},t.initializeAdapterInstance=function(t,i,f){f=f===undefined?!0:f;n(t,"interfaceName").isNonEmptyString().check();n(i,"adapterName").isNonEmptyString().check();n(f,"isDefault").isBoolean().check();var e=r(t),o=e.getImpl(i);if(!o)throw new Error("Unregistered adapter.  Interface: "+t+" AdapterName: "+i);return u(e,o,f)},t.getAdapterInstance=function(n,t){var f=r(n),i;return t&&t!==""?(i=f.getImpl(t),i?i.defaultInstance:null):f.defaultInstance?f.defaultInstance:(i=f.getFirstImpl(),i.defaultInstance?i.defaultInstance:u(f,i,!0))},t.registerFunction=function(i,r){n(i,"fn").isFunction().check();n(r,"fnName").isString().check();i.prototype._$fnName=r;t.functionRegistry[r]=i},t._storeObject=function(n,i,r){var u=(typeof i=="string"?i:i.prototype._$typeName)+"."+r;t.objectRegistry[u]=n},t._fetchObject=function(n,i){if(!i)return undefined;var r=(typeof n=="string"?n:n.prototype._$typeName)+"."+i,u=t.objectRegistry[r];if(!u)throw new Error("Unable to locate a registered object by the name: "+r);return u},t.registerType=function(i,r){n(i,"ctor").isFunction().check();n(r,"typeName").isString().check();i.prototype._$typeName=r;t.typeRegistry[r]=i},t.stringifyPad="",t}();ni=y.interfaceRegistry.modelLibrary;r.config=y;t.config=y;var ti=function(){function u(n){var t=n.getEntityAspect();t.entityState.isUnchanged()&&t.setModified();t.entityState.isModified()&&!n._origValues&&(n._origValues=n.slice(0))}function t(n,t){n._processAdds(t);r(n,"arrayChanged",{array:n,added:t})}function i(n,t){n._processRemoves(t);r(n,"arrayChanged",{array:n,removed:t})}function r(n,t,i){var r=n._getPendingPubs();r?n._pendingArgs?f(n._pendingArgs,i):(n._pendingArgs=i,r.push(function(){n[t].publish(n._pendingArgs);n._pendingArgs=null})):n[t].publish(i)}function f(n,t){var i,u,r;for(i in t)if(i!=="array"&&n.hasOwnProperty(i))if(u=t[i],r=n[i],r){if(!Array.isArray(r))throw new Error("Cannot combine non array args");Array.prototype.push.apply(r,u)}else n[i]=u}function e(n,t,i){n.parent=t;n.parentProperty=i}var n={};return n.push=function(){var n,i;return this._inProgress?-1:(n=this._getGoodAdds(d(arguments)),!n.length)?this.length:(this._beforeChange(),i=Array.prototype.push.apply(this,n),t(this,n),i)},n._push=function(){var n,i;return this._inProgress?-1:(n=d(arguments),this._beforeChange(),i=Array.prototype.push.apply(this,n),t(this,n),i)},n.unshift=function(){var n=this._getGoodAdds(d(arguments)),i;return n.length?(this._beforeChange(),i=Array.prototype.unshift.apply(this,n),t(this,d(n)),i):this.length},n.pop=function(){this._beforeChange();var n=Array.prototype.pop.apply(this);return i(this,[n]),n},n.shift=function(){this._beforeChange();var n=Array.prototype.shift.apply(this);return i(this,[n]),n},n.splice=function(){var n=this._getGoodAdds(d(arguments,2)),u=d(arguments,0,2).concat(n),r;return this._beforeChange(),r=Array.prototype.splice.apply(this,u),i(this,r),n.length&&t(this,n),r},n.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},n._getEventParent=function(){return this.getEntityAspect()},n._getPendingPubs=function(){var n=this.getEntityAspect().entityManager;return n&&n._pendingPubs},n._beforeChange=function(){},{mixin:n,publish:r,updateEntityState:u,initializeParent:e}}(),e=function(){function a(n,t,i,r,u){for(r=+n[t=n.length-1],u=0;t--;)i=+n[t],r+=++u%2?2*i%10+(i>4):i;return!(r%10)}function i(t,i,r,u){r&&(n.messageTemplates[t]=r);var f=typeof i=="string"?new RegExp(i):i,e=function(n){return n==null||n===""?!0:typeof n!="string"?!1:f.test(n)};return new n(t,e,u)}function v(n,t,i){return t?n.replace(/%([^%]+)%/g,function(n,r){var u;return u=i?t.hasOwnProperty(r)?t[r]:"":t[r],u?gi(u)?u(t):u:""}):n}function r(t,i,r,u){return n.messageTemplates[t]=p("'%displayName%' must be an integer between the values of %1 and %2",i,r),function(){var f=function(n,t){return n==null?!0:(typeof n=="string"&&t&&t.allowString&&(n=parseInt(n,0)),typeof n!="number"||isNaN(n)||Math.floor(n)!==n?!1:i!=null&&n<i?!1:r!=null&&n>r?!1:!0)};return new n(t,f,u)}}var u=-32768,f=32767,e=-2147483648,o=2147483647,s=0,c=255,l={displayName:function(n){return n.property?n.property.displayName||n.propertyName||n.property.name:"Value"}},n=function(t,i,r){this._baseContext=r||{};this._baseContext.name=t;r=h(Object.create(l),this._baseContext);r.messageTemplate=r.messageTemplate||n.messageTemplates[t];this.name=t;this.valFn=i;this.context=r},t=n.prototype;return t._$typeName="Validator",t.validate=function(n,t){var i;i=t?h(Object.create(this.context),t):this.context;this.currentContext=i;try{return this.valFn(n,i)?null:(i.value=n,new ht(this,i,this.getMessage()))}catch(r){return new ht(this,i,"Exception occured while executing this validator: "+this.name)}},t.getMessage=function(){try{var n=this.currentContext,t=n.message;return t?typeof t=="function"?t(n):t:n.messageTemplate?v(n.messageTemplate,n):"invalid value: "+this.name||"{unnamed validator}"}catch(i){return"Unable to format error message"+i.toString()}},t.toJSON=function(){return this._baseContext},n.fromJSON=function(n){var i="Validator."+n.name,t=y.functionRegistry[i];if(!t)throw new Error("Unable to locate a validator named:"+n.name);return t(n)},n.register=function(n){y.registerFunction(function(){return n},"Validator."+n.name)},n.registerFactory=function(n,t){y.registerFunction(n,"Validator."+t)},n.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},n.required=function(t){var i=function(n,t){return typeof n=="string"?t&&t.allowEmptyStrings?!0:n.length>0:n!=null};return new n("required",i,t)},n.maxLength=function(t){var i=function(n,t){return n==null?!0:typeof n!="string"?!1:n.length<=t.maxLength};return new n("maxLength",i,t)},n.stringLength=function(t){var i=function(n,t){return n==null?!0:typeof n!="string"?!1:t.minLength!=null&&n.length<t.minLength?!1:t.maxLength!=null&&n.length>t.maxLength?!1:!0};return new n("stringLength",i,t)},n.string=function(){var t=function(n){return n==null?!0:typeof n=="string"};return new n("string",t)},n.guid=function(){var t=function(n){return n==null?!0:nr(n)};return new n("guid",t)},n.duration=function(){var t=function(n){return n==null?!0:tr(n)};return new n("duration",t)},n.number=n.double=n.single=function(t){var i=function(n,t){return n==null?!0:(typeof n=="string"&&t&&t.allowString&&(n=parseInt(n,10)),typeof n=="number"&&!isNaN(n))};return new n("number",i,t)},n.integer=n.int64=function(t){var i=function(n,t){return n==null?!0:(typeof n=="string"&&t&&t.allowString&&(n=parseInt(n,10)),typeof n=="number"&&!isNaN(n)&&Math.floor(n)===n)};return new n("integer",i,t)},n.int32=function(n){return r("int32",e,o,n)()},n.int16=function(n){return r("int16",u,f,n)()},n.byte=function(n){return r("byte",s,c,n)()},n.bool=function(){var t=function(n){return n==null?!0:n===!0||n===!1};return new n("bool",t)},n.none=function(){var t=function(){return!0};return new n("none",t)},n.date=function(){var t=function(n){if(n==null)return!0;if(typeof n=="string")try{return!isNaN(Date.parse(n))}catch(t){return!1}else return at(n)};return new n("date",t)},n.creditCard=function(t){function i(n){return n==null||n===""?!0:typeof n!="string"?!1:(n=n.replace(/(\-|\s)/g,""),!n||/\D/.test(n))?!1:a(n)}return new n("creditCard",i,t)},n.regularExpression=function(t){function i(n,t){if(n==null||n==="")return!0;if(typeof n!="string")return!1;try{var i=new RegExp(t.expression)}catch(r){throw new Error("Missing or invalid expression parameter to regExp validator");}return i.test(n)}return new n("regularExpression",i,t)},n.emailAddress=function(n){return i("emailAddress",/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/,null,n)},n.phone=function(n){return i("phone",/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/,null,n)},n.url=function(n){return i("url",/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,null,n)},n.makeRegExpValidator=i,it(n,function(n,t){typeof t=="function"&&n!=="fromJSON"&&n!=="register"&&n!=="registerFactory"&&n!=="makeRegExpValidator"&&y.registerFunction(t,"Validator."+n)}),n}(),ht=function(){var t=function(t,i,r,u){n(t,"validator").isOptional().isInstanceOf(e).check();n(r,"errorMessage").isNonEmptyString().check();n(u,"key").isOptional().isNonEmptyString().check();this.validator=t;var i=i||{};this.context=i;this.errorMessage=r;this.property=i.property;this.propertyName=i.propertyName||i.property&&i.property.name;this.key=u?u:ht.getKey(t||r,this.propertyName);this.isServerError=!1};return t.getKey=function(n,t){return(n.name||n)+(t?":"+t:"")},t}();t.Validator=e;t.ValidationError=ht;ii=function(){function i(n,t){return t&&s(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="ValidationOptions",t.using=function(n){if(!n)return this;var t=new ii(this);return i(t,n),t},t.setAsDefault=function(){return ui(this,n)},n.defaultInstance=new n({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),n}();t.ValidationOptions=ii;t.makeComplexArray=function(){function i(n,t){return t.filter(function(t){return t.parent!==n.parent})}function r(n,t){t.forEach(function(t){if(t.parent!=null)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");f(t,n)})}function u(n,i){i.forEach(function(i){t(i,n)})}function t(n,t){var i=n.complexAspect;return i.parent!==t.parent?null:(i.parent=null,i.parentProperty=null,i)}function f(n,t){var i=n.complexAspect;return i.parent===t.parent?null:(i.parent=t.parent,i.parentProperty=t.parentProperty,i)}function e(t,i,r){return ti.initializeParent(t,i,r),t.arrayChanged=new tt("arrayChanged",t),h(t,ti.mixin),h(t,n)}var n={};return n._getGoodAdds=function(n){return i(this,n)},n._beforeChange=function(){ti.updateEntityState(this)},n._processAdds=function(n){r(this,n)},n._processRemoves=function(n){u(this,n)},n._rejectChanges=function(){if(this._origValues){var n=this;this.forEach(function(i){t(i,n)});this.length=0;this._origValues.forEach(function(t){n.push(t)});Array.prototype.push.apply(this,this._origValues)}},n._acceptChanges=function(){this._origValues=null},e}();g=function(){var t={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},n=new et("EntityAction",t);return n.Attach=n.addSymbol({isAttach:!0}),n.AttachOnQuery=n.addSymbol({isAttach:!0}),n.AttachOnImport=n.addSymbol({isAttach:!0}),n.Detach=n.addSymbol({isDetach:!0}),n.MergeOnQuery=n.addSymbol({isModification:!0}),n.MergeOnImport=n.addSymbol({isModification:!0}),n.MergeOnSave=n.addSymbol({isModification:!0}),n.PropertyChange=n.addSymbol({isModification:!0}),n.EntityStateChange=n.addSymbol(),n.AcceptChanges=n.addSymbol(),n.RejectChanges=n.addSymbol({isModification:!0}),n.Clear=n.addSymbol({isDetach:!0}),n.seal(),n}();t.EntityAction=g;ot=function(){function i(n){var u=n.entityAspect||n.complexAspect,f=n.entityType||n.complexType,t=u.originalValues;for(var r in t)n.setProperty(r,t[r]);f.complexProperties.forEach(function(t){var r=n.getProperty(t.name);t.isScalar?i(r):(r._rejectChanges(),r.forEach(function(n){i(n)}))})}function r(n){var i=n.entityAspect||n.complexAspect,t;i.originalValues={};t=n.entityType||n.complexType;t.complexProperties.forEach(function(t){var i=n.getProperty(t.name);t.isScalar?r(i):(i._acceptChanges(),i.forEach(function(n){r(n)}))})}function f(n){var t=!0,r=n.entityType||n.complexType,u=n.entityAspect||n.complexAspect,i=n.entityAspect||n.complexAspect.getEntityAspect();return r.getProperties().forEach(function(r){var e=n.getProperty(r.name),s=u.getPropertyPath(r.name),o;r.validators.length>0&&(o={entity:i.entity,property:r,propertyName:s},t=i._validateProperty(e,o)&&t);r.isComplexProperty&&r.isScalar&&(t=f(e)&&t)}),r.validators.forEach(function(n){t=v(i,n,u.entity)&&t}),t}function h(n,t){var i=t.isDeleted();i?c(n,!0):gt(n.entityAspect.entityManager,"isLoading",!0,function(){c(n,!1)})}function c(n,t){n.entityType.navigationProperties.forEach(function(i){var r=i.inverse,u=n.getProperty(i.name),f;i.isScalar?u&&(r&&(r.isScalar?a(u,r,t):(f=u.getProperty(r.name),f.length&&or(f,n))),n.setProperty(i.name,null)):(r&&u.slice(0).forEach(function(n){r.isScalar&&a(n,r,t)}),u.length=0)})}function a(n,t,i){var f,r,u;i?n.setProperty(t.name,null):(f=n.entityAspect.entityManager,r=t.foreignKeyNames,r&&(u=r.map(function(t){return n.getProperty(t)})),n.setProperty(t.name,null),r&&r.forEach(function(t,i){n.setProperty(t,u[i])}))}function v(n,t,i,r){var u=t.validate(i,r),f;return u?(n._addValidationError(u),!1):(f=ht.getKey(t,r?r.propertyName:null),n._removeValidationError(f),!0)}var s=function(n){var t,i,r,f;if(n===null){if(t=ot._nullInstance,t)return t;ot._nullInstance=this}else if(n===undefined)throw new Error("The EntityAspect ctor requires an entity as its only argument.");else if(n.entityAspect)return n.entityAspect;if(!(this instanceof ot))return new ot(n);if(this.entity=n,this.entityGroup=null,this.entityManager=null,this.entityState=u.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new tt("validationErrorsChanged",this),this.propertyChanged=new tt("propertyChanged",this),n!=null){if(n.entityAspect=this,i=n.entityType||n._$entityType,!i)if(r=n.prototype._$typeName,r)throw new Error("Metadata for this entityType has not yet been resolved: "+r);else throw new Error("This entity is not registered as a valid EntityType");f=i.getEntityCtor();ni.getDefaultInstance().startTracking(n,f.prototype)}},t=s.prototype;return tt.bubbleEvent(t,function(){return this.entityManager}),t.getKey=function(t){if(t=n(t,"forceRefresh").isBoolean().isOptional().check(!1),t||!this._entityKey){var i=this.entity.entityType,r=i.keyProperties,u=r.map(function(n){return this.entity.getProperty(n.name)},this);this._entityKey=new o(i,u)}return this._entityKey},t.acceptChanges=function(){var n=this.entityManager;this.entityState.isDeleted()?n.detachEntity(this.entity):this.setUnchanged();n.entityChanged.publish({entityAction:g.AcceptChanges,entity:this.entity})},t.rejectChanges=function(){var n=this.entity,t=this.entityManager;gt(t,"isRejectingChanges",!0,function(){i(n)});this.entityState.isAdded()?(t.detachEntity(n),t._notifyStateChange(n,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(n),this.setUnchanged(),this.propertyChanged.publish({entity:n,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:g.RejectChanges,entity:n}))},t.getPropertyPath=function(n){return n},t.setUnchanged=function(){r(this.entity);delete this.hasTempKey;this.entityState=u.Unchanged;this.entityManager._notifyStateChange(this.entity,!1)},t.setModified=function(){this.entityState=u.Modified;this.entityManager._notifyStateChange(this.entity,!0)},t.setDeleted=function(){var t=this.entityManager,n=this.entity;this.entityState.isAdded()?(t.detachEntity(n),t._notifyStateChange(n,!1)):(this.entityState=u.Deleted,h(n,u.Deleted),t._notifyStateChange(n,!0))},t.setDetached=function(){var t=this.entityGroup,n;return t?(n=this.entity,t.detachEntity(n),h(n,u.Detached),this.entityManager.entityChanged.publish({entityAction:g.Detach,entity:n}),this._detach(),!0):!1},t.loadNavigationProperty=function(n,t,i){var r=this.entity,u=r.entityType._checkNavProperty(n),f=rt.fromEntityNavigation(r,u);return r.entityAspect.entityManager.executeQuery(f,t,i)},t.validateEntity=function(){var n=!0;return this._processValidationOpAndPublish(function(t){n=f(t.entity)}),n},t.validateProperty=function(n,t){var i=this.getPropertyValue(n);return i&&i.complexAspect?f(i):(t=t||{},t.entity=this.entity,typeof n=="string"?(t.property=this.entity.entityType.getProperty(n,!0),t.propertyName=n):(t.property=n,t.propertyName=n.name),this._validateProperty(i,t))},t.getValidationErrors=function(t){var i,r;return n(t,"property").isOptional().isEntityProperty().or().isString().check(),i=kr(this._validationErrors),t&&(r=typeof t=="string"?t:t.name,i=i.filter(function(n){return n.property&&n.property.name===r})),i},t.addValidationError=function(t){n(t,"validationError").isInstanceOf(ht).check();this._processValidationOpAndPublish(function(n){n._addValidationError(t)})},t.removeValidationError=function(t){n(t,"validationErrorOrKey").isString().or().isInstanceOf(ht).or().isInstanceOf(e).check();var i=typeof t=="string"?t:t.key;this._processValidationOpAndPublish(function(n){n._removeValidationError(i)})},t.clearValidationErrors=function(){this._processValidationOpAndPublish(function(n){it(n._validationErrors,function(t,i){i&&(delete n._validationErrors[t],n._pendingValidationResult.removed.push(i))});n.hasValidationErrors=!ft(this._validationErrors)})},t.getParentKey=function(n){var t=n.foreignKeyNames,i,r;return t.length===0?null:(i=this,r=t.map(function(n){return i.entity.getProperty(n)}),new o(n.entityType,r))},t.getPropertyValue=function(t){var i,r,u;if(n(t,"property").isString().or().isEntityProperty().check(),typeof t=="string")for(r=t.trim().split("."),u=r.shift(),i=this.entity,i=i.getProperty(u);r.length>0;)u=r.shift(),i=i.getProperty(u);else{if(!(t.parentType instanceof l))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");i=this.entity.getProperty(t.name)}return i},t._detach=function(){this.entityGroup=null;this.entityManager=null;this.entityState=u.Detached;this.originalValues={};this._validationErrors={};this.hasValidationErrors=!1;this.validationErrorsChanged.clear();this.propertyChanged.clear()},t._validateProperty=function(n,t){var i=!0;return this._processValidationOpAndPublish(function(r){t.property.validators.forEach(function(u){i=v(r,u,n,t)&&i})}),i},t._processValidationOpAndPublish=function(n){if(this._pendingValidationResult)n(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]};n(this);(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=undefined}},t._addValidationError=function(n){this._validationErrors[n.key]=n;this.hasValidationErrors=!0;this._pendingValidationResult.added.push(n)},t._removeValidationError=function(n){var t=this._validationErrors[n];t&&(delete this._validationErrors[n],this.hasValidationErrors=!ft(this._validationErrors),this._pendingValidationResult.removed.push(t))},s}();ei=function(){var n=function(n,t,i){var r,u,f;if(!n)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(n.complexAspect)return n.complexAspect;if(!(this instanceof ei))return new ei(n,t,i);if(this.complexObject=n,n.complexAspect=this,this.originalValues={},t!=null&&(this.parent=t,this.parentProperty=i),r=n.complexType,!r)if(u=n.prototype._$typeName,u)throw new Error("Metadata for this complexType has not yet been resolved: "+u);else throw new Error("This entity is not registered as a valid ComplexType");f=r.getCtor();ni.getDefaultInstance().startTracking(n,f.prototype)},t=n.prototype;return t.getEntityAspect=function(){var n=this.parent,t;if(!n)return new ot(null);for(t=n.entityAspect;n&&!t;)n=n.complexAspect&&n.complexAspect.parent,t=n&&n.entityAspect;return t||new ot(null)},t.getPropertyPath=function(n){var t=this.parent,i;return t?(i=t.complexAspect||t.entityAspect,i.getPropertyPath(this.parentProperty.name+"."+n)):null},n}();t.EntityAspect=ot;t.ComplexAspect=ei;o=function(){function u(n){return n.join(f)}var f=":::",t=function(t,r){n(t,"entityType").isInstanceOf(l).check();var f=t.getSelfAndSubtypes();f.length>1&&(this._subtypes=f.filter(function(n){return n.isAbstract===!1}));Array.isArray(r)||(r=d(arguments,1));this.entityType=t;t.keyProperties.forEach(function(n,t){n.dataType===i.Guid&&(r[t]=r[t]&&r[t].toLowerCase())});this.values=r;this._keyInGroup=u(r)},r;return t._$typeName="EntityKey",r=t.prototype,r.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},t.fromJSON=function(n,t){var i=t._getEntityType(n.entityType,!0);return new o(i,n.values)},r.equals=function(n){return(n instanceof o)?this.entityType===n.entityType&&sr(this.values,n.values):!1},r.toString=function(){return this.entityType.name+"-"+this._keyInGroup},t.equals=function(n,t){return(n instanceof o)?n.equals(t):!1},r._isEmpty=function(){return this.values.join("").length===0},t.createKeyString=u,t}();t.EntityKey=o;u=function(){var t={isUnchanged:function(){return this===n.Unchanged},isAdded:function(){return this===n.Added},isModified:function(){return this===n.Modified},isDeleted:function(){return this===n.Deleted},isDetached:function(){return this===n.Detached},isUnchangedOrModified:function(){return this===n.Unchanged||this===n.Modified},isAddedModifiedOrDeleted:function(){return this===n.Added||this===n.Modified||this===n.Deleted}},n=new et("EntityState",t);return n.Unchanged=n.addSymbol(),n.Added=n.addSymbol(),n.Modified=n.addSymbol(),n.Deleted=n.addSymbol(),n.Detached=n.addSymbol(),n.seal(),n}();t.EntityState=u;t.makePrimitiveArray=function(){function t(t,i,r){return ti.initializeParent(t,i,r),t.arrayChanged=new tt("arrayChanged",t),h(t,ti.mixin),h(t,n)}var n={};return n._getGoodAdds=function(n){return n},n._beforeChange=function(){var n=this.getEntityAspect();n.entityState.isUnchanged()&&n.setModified();n.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},n._processAdds=function(){},n._processRemoves=function(){},n._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},n._acceptChanges=function(){this._origValues=null},t}();t.makeRelationArray=function(){function t(n,t){var i=f(n,t),e,r;return i.length?(e=n.parentEntity,r=e.entityAspect.entityManager,r&&!r.isLoading&&i.forEach(function(t){if(t.entityAspect.entityState.isDetached()){n._inProgress=!0;try{r.attachEntity(t,u.Added)}finally{n._inProgress=!1}}}),i):i}function i(n,t){var i=n.parentEntity,u=n.navigationProperty,r=n._addsInProcess,f=u.inverse,e=r.length;try{t.forEach(function(n){if(r.push(n),f)n.setProperty(f.name,i);else{var t=i.entityType.keyProperties;u.invForeignKeyNames.forEach(function(r,u){n.setProperty(r,i.getProperty(t[u].name))})}})}finally{r.splice(e,t.length)}}function r(n,t){var i=n.navigationProperty.inverse;i&&t.forEach(function(n){n.setProperty(i.name,null)})}function f(n,t){var i=n.parentEntity,u=n.navigationProperty,f=u.inverse,r,e,o;return f?r=t.filter(function(t){if(n._addsInProcess.indexOf(t)>=0)return!1;var r=t.getProperty(f.name);return r!==i}):(e=u.invForeignKeyNames,o=i.entityType.keyProperties,r=t.filter(function(t){return n._addsInProcess.indexOf(t)>=0?!1:e.some(function(n,r){var u=o[r].name,f=i.getProperty(u),e=t.getProperty(n);return f!==e})})),r}function e(t,i,r){return t.parentEntity=i,t.navigationProperty=r,t.arrayChanged=new tt("arrayChanged",t),t._addsInProcess=[],h(t,ti.mixin),h(t,n)}var n={};return n.load=function(n,t){var i=this.parentEntity,r=rt.fromEntityNavigation(this.parentEntity,this.navigationProperty),u=i.entityAspect.entityManager;return u.executeQuery(r,n,t)},n._getEventParent=function(){return this.parentEntity.entityAspect},n._getPendingPubs=function(){var n=this.parentEntity.entityAspect.entityManager;return n&&n._pendingPubs},n._getGoodAdds=function(n){return t(this,n)},n._processAdds=function(n){i(this,n)},n._processRemoves=function(n){r(this,n)},e}();i=function(){function f(n,t){n=p(n,t);throw new Error(n);}function ut(t){switch(t){case n.String:return e.string;case n.Int64:return e.int64;case n.Int32:return e.int32;case n.Int16:return e.int16;case n.Decimal:return e.number;case n.Double:return e.number;case n.Single:return e.number;case n.DateTime:return e.date;case n.DateTimeOffset:return e.date;case n.Boolean:return e.bool;case n.Guid:return e.guid;case n.Byte:return e.byte;case n.Binary:return e.none;case n.Time:return e.duration;case n.Undefined:return e.none}}var i={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1},a=function(){return i.stringPrefix+t().toString()},t=function(){var n=i.nextNumber;return i.nextNumber+=i.nextNumberIncrement,n},v=function(){return fi()},h=function(){return new Date},y=function(n){return n==null?n:n.toString()},r=function(n,t){var i,r;return t==="string"?(i=n.trim(),i==="")?null:(r=parseInt(i,10),isNaN(r)?n:r):t==="number"?Math.round(n):n},o=function(n,t){var i,r;return t==="string"?(i=n.trim(),i==="")?null:(r=parseFloat(i),isNaN(r)?n:r):n},c=function(n,t){var i,r;return t==="string"?(r=n.trim(),r==="")?null:(i=new Date(Date.parse(r)),at(i)?i:n):t==="number"?(i=new Date(n),at(i)?i:n):n},w=function(n,t){if(t==="string"){var i=n.trim().toLowerCase();return i==="false"||i===""?!1:i==="true"?!0:n}return n},b=function(n){return n==null?null:"'"+n+"'"},u=function(n){return n==null?null:typeof n=="string"?parseInt(n,10):n},s=function(n){return function(t){return t==null?null:(typeof t=="string"&&(t=parseFloat(t)),t+n)}},k=function(n){if(n==null)return null;try{return"datetime'"+n.toISOString()+"'"}catch(t){f("'%1' is not a valid dateTime",n)}},d=function(n){if(n==null)return null;try{return"datetimeoffset'"+n.toISOString()+"'"}catch(t){f("'%1' is not a valid dateTime",n)}},g=function(n){return n==null?null:(tr(n)||f("'%1' is not a valid ISO 8601 duration",n),"time'"+n+"'")},nt=function(n){return n==null?null:(nr(n)||f("'%1' is not a valid guid",n),"guid'"+n+"'")},tt=function(n){return n==null?null:typeof n=="string"?n.trim().toLowerCase()==="true":!!n},it=function(n){return n==null?n:"binary'"+n+"'"},rt=function(n){return n},n=new et("DataType",{}),l;return n.String=n.addSymbol({defaultValue:"",parse:y,fmtOData:b,getNext:a}),n.Int64=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:r,fmtOData:u,getNext:t}),n.Int32=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:r,fmtOData:u,getNext:t}),n.Int16=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:r,fmtOData:u,getNext:t}),n.Byte=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:r,fmtOData:u}),n.Decimal=n.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,parse:o,fmtOData:s("m"),getNext:t}),n.Double=n.addSymbol({defaultValue:0,isNumeric:!0,parse:o,fmtOData:s("d"),getNext:t}),n.Single=n.addSymbol({defaultValue:0,isNumeric:!0,parse:o,fmtOData:s("f"),getNext:t}),n.DateTime=n.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:c,fmtOData:k,getNext:h}),n.DateTimeOffset=n.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:c,fmtOData:d,getNext:h}),n.Time=n.addSymbol({defaultValue:"PT0S",fmtOData:g}),n.Boolean=n.addSymbol({defaultValue:!1,parse:w,fmtOData:tt}),n.Guid=n.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:nt,getNext:v}),n.Binary=n.addSymbol({defaultValue:null,fmtOData:it}),n.Undefined=n.addSymbol({defaultValue:undefined,fmtOData:rt}),n.seal(),n.fromEdmDataType=function(t){var u=null,i=t.split("."),r;return i.length>1&&(r=i[1],u=r==="image"?n.Byte:i.length===2?n.fromName(r)||n.Undefined:n.String),u},n.fromValue=function(t){if(at(t))return n.DateTime;switch(typeof t){case"string":return nr(t)?n.Guid:tr(t)&&t.length>3?n.Time:n.String;case"boolean":return n.Boolean;case"number":return n.Int32}return n.Undefined},l=/.\d{3}$/,n.parseTimeFromServer=function(n){if(typeof n=="string")return n;if(n&&n.__edmType==="Edm.Time"){var t=Math.floor(n.ms/1e3);return"PT"+t+"S"}return n},n.parseDateAsUTC=function(n){if(typeof n=="string"){var t=l.test(n);n=t?n+"Z":n}return new Date(Date.parse(n))},n.parseDateFromServer=n.parseDateAsUTC,n.parseRawValue=function(t,i){return t===undefined?undefined:(i.isDate&&t?at(t)||(t=n.parseDateFromServer(t)):i===n.Binary?t&&t.$value!==undefined&&(t=t.$value):i===n.Time&&(t=n.parseTimeFromServer(t)),t)},n.constants=i,n.getSymbols().forEach(function(n){n.validatorCtor=ut(n)}),n}();t.DataType=i;c=function(){function i(n,t){return t&&(s(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(oi).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(n),n.serviceName=n.serviceName&&c._normalizeServiceName(n.serviceName),n.adapterInstance=n.adapterName&&y.getAdapterInstance("dataService",n.adapterName)),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="DataService",t.using=function(n){if(!n)return this;var t=new c(this);return i(t,n)},n.resolve=function(n){n.push({hasServerMetadata:!0,useJsonp:!1});var t=new c(dr(n,["serviceName","adapterName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return t.adapterInstance=t.adapterInstance||y.getAdapterInstance("dataService",t.adapterName),t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter,t},n._normalizeServiceName=function(n){return n=n.trim(),n.substr(-1)!=="/"?n+"/":n},t.toJSON=function(){return kt(this,{serviceName:null,adapterName:null,hasServerMetadata:null,jsonResultsAdapter:function(n){return n&&n.name},useJsonp:null})},n.fromJSON=function(n){return n.jsonResultsAdapter=y._fetchObject(oi,n.jsonResultsAdapter),new c(n)},t.makeUrl=function(n){var t=this.serviceName;return r.stringEndsWith(t,"/")&&(t=t.substr(0,t.length-1)),n="/"+n,r.stringEndsWith(t,n)||(t=t+n),t},n}();oi=function(){function i(n){return n.results}var n=function(n){if(arguments.length!==1)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");s(n).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(i).whereParam("visitNode").isFunction().applyAll(this);y._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="JsonResultsAdapter",n}();t.DataService=c;t.JsonResultsAdapter=oi;f=hr("Q");f||(f=function(){throw new Error("Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q");},f.defer=f.resolve=f.reject=f);t.config.setQ=function(n){f=n};var yt=function(){function w(n){var i=[],t,r;for(t in n)r=n[t],t===r.name&&i.push(n[t]);return i}function b(n,t,i){var o=si(t.shortName,t.namespace),r=n._getEntityType(o,!0),f,e;return r?i?d(r,t):r:(f={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:st.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName,custom:t.custom},r=t.isComplexType?new pt(f):new l(f),t.baseTypeName?(r.baseTypeName=t.baseTypeName,e=n._getEntityType(t.baseTypeName,!0),e?u(n,t,r,e):di(n._deferredTypes,t.baseTypeName).push({json:t,stype:r})):u(n,t,r,null),r)}function d(n,t){return t.custom&&(n.custom=t.custom),a(n,t.dataProperties),a(n,t.navigationProperties),n}function a(n,t){t&&t.forEach(function(t){var i=t.name,r;if(!i)if(t.nameOnServer)i=n.metadataStore.namingConvention.serverPropertyNameToClient(t.nameOnServer,{});else throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");t.custom&&(r=n.getProperty(i,!0),r.custom=t.custom)})}function u(n,t,i,r){var s,f,o;t.validators&&(i.validators=t.validators.map(e.fromJSON));r&&(i.baseEntityType=r,r.dataProperties.forEach(function(n){var t=new k(n);t.isInherited=!0;i.addProperty(t)}),r.navigationProperties.forEach(function(n){var t=new ct(n);t.isInherited=!0;i.addProperty(t)}));t.dataProperties.forEach(function(n){i.addProperty(k.fromJSON(n))});s=!t.isComplexType;s&&t.navigationProperties&&t.navigationProperties.forEach(function(n){i.addProperty(ct.fromJSON(n))});n.addEntityType(i);f=n._deferredTypes;o=f[i.name];o&&(o.forEach(function(t){u(n,t.json,t.stype,i)}),delete f[i.name])}function o(n,t,i){if(fu(t))return t;var r=n._shortNameMap[t];if(!r&&i)throw new Error("Unable to locate 'entityTypeName' of: "+t);return r}var v=0,r=function(n){n=n||{};s(n).whereParam("namingConvention").isOptional().isInstanceOf(ci).withDefault(ci.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(hi).withDefault(hi.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this);this.dataServices=[];this._resourceEntityTypeMap={};this._structuralTypeMap={};this._shortNameMap={};this._ctorRegistry={};this._incompleteTypeMap={};this._incompleteComplexTypeMap={};this._id=v++},i=r.prototype;return i._$typeName="MetadataStore",r.ANONTYPE_PREFIX="_IB_",i.setProperties=function(n){s(n).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},i.addDataService=function(t,i){n(t,"dataService").isInstanceOf(c).check();n(i,"shouldOverwrite").isBoolean().isOptional().check();var r=this._getDataServiceIndex(t.serviceName);if(r>=0)if(!i)throw new Error("A dataService with this name '"+t.serviceName+"' already exists in this MetadataStore");else this.dataServices[r]=t;else this.dataServices.push(t)},i._getDataServiceIndex=function(n){return er(this.dataServices,function(t){return t.serviceName===n})},i.addEntityType=function(n){if(n instanceof l||n instanceof pt||(n=n.isComplexType?new pt(n):new l(n)),!n.isComplexType&&n.keyProperties.length===0&&!n.isAbstract)throw new Error("Unable to add "+n.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.");if(n.metadataStore=this,!n.isAnonymous){if(this._structuralTypeMap[n.name])throw new Error("Type "+n.name+" already exists in this MetadataStore.");this._structuralTypeMap[n.name]=n;this._shortNameMap[n.shortName]=n.name}if(n.getProperties().forEach(function(t){n._updateNames(t);t.isUnmapped||n._mappedPropertiesCount++}),n._updateCps(),!n.isComplexType){n._updateNps();var t=n.defaultResourceName||n.baseEntityType&&n.baseEntityType.defaultResourceName;t&&!this.getEntityTypeNameForResourceName(t)&&this.setEntityTypeForResourceName(t,n.name);n.defaultResourceName=t;n.getEntityCtor()}n.baseEntityType&&n.baseEntityType.subtypes.push(n)},i.exportMetadata=function(){return JSON.stringify({metadataVersion:t.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:fr(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,y.stringifyPad)},i.importMetadata=function(i,r){var u,s,f,e,o,l;if(n(r,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={},u=typeof i=="string"?JSON.parse(i):i,u.schema)return uu.parse(this,u.schema,u.altMetadata);if(u.metadataVersion&&u.metadataVersion!==t.metadataVersion){s=p("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",u.metadataVersion,t.metadataVersion);throw new Error(s);}if(f=u.namingConvention,e=u.localQueryComparisonOptions,this.isEmpty())this.namingConvention=y._fetchObject(ci,f)||this.namingConvention,this.localQueryComparisonOptions=y._fetchObject(hi,e)||this.localQueryComparisonOptions;else{if(f&&this.namingConvention.name!==f)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(e&&this.localQueryComparisonOptions.name!==e)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore");}return o=this,u.dataServices&&u.dataServices.forEach(function(n){n=c.fromJSON(n);o.addDataService(n,!0)}),l=this._structuralTypeMap,u.structuralTypes&&u.structuralTypes.forEach(function(n){b(o,n,r)}),h(this._resourceEntityTypeMap,u.resourceEntityTypeMap),h(this._incompleteTypeMap,u.incompleteTypeMap),this},r.importMetadata=function(n){var t=new yt;return t.importMetadata(n),t},i.hasMetadataFor=function(n){return!!this.getDataService(n)},i.getDataService=function(t){return n(t,"serviceName").isString().check(),t=c._normalizeServiceName(t),nt(this.dataServices,function(n){return n.serviceName===t})},i.fetchMetadata=function(t,i,r){if(n(t,"dataService").isString().or().isInstanceOf(c).check(),n(i,"callback").isFunction().isOptional().check(),n(r,"errorCallback").isFunction().isOptional().check(),typeof t=="string"&&(t=this.getDataService(t)||new c({serviceName:t})),t=c.resolve([t]),this.hasMetadataFor(t.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+t.serviceName);return t.adapterInstance.fetchMetadata(this,t).then(function(n){return i&&i(n),f.resolve(n)},function(n){return r&&r(n),f.reject(n)})},i.trackUnmappedType=function(t,i){n(t,"entityCtor").isFunction().check();n(i,"interceptor").isFunction().isOptional().check();var r=new l(this);r._setCtor(t,i)},i.registerEntityTypeCtor=function(t,i,r,u){var f,s,e;n(t,"structuralTypeName").isString().check();n(i,"aCtor").isFunction().isOptional().check();n(r,"initFn").isOptional().isFunction().or().isString().check();n(u,"noTrackingFn").isOptional().isFunction().check();f=o(this,t,!1);s=f||t;this._ctorRegistry[s]={ctor:i,initFn:r,noTrackingFn:u};f&&(e=this._structuralTypeMap[f],e&&e.getCtor(!0))},i.toQueryString=function(n){if(!n)throw new Error("query cannot be empty");if(typeof n=="string")return n;if(n instanceof rt)return n._toUri(this);throw new Error("unable to recognize query parameter as either a string or an EntityQuery");},i.isEmpty=function(){return ft(this._structuralTypeMap)},i.getEntityType=function(t,i){return n(t,"structuralTypeName").isString().check(),n(i,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(t,i)},i._getEntityType=function(n,t){var f=o(this,n,!1),i=this._structuralTypeMap[f],r,u;if(!i){if(t)return null;r=p("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",n);throw new Error(r);}if(i.length){u=i.join(",");throw new Error("There are multiple types with this 'shortName': "+u);}return i},i.getEntityTypes=function(){return w(this._structuralTypeMap)},i.getIncompleteNavigationProperties=function(){return fr(this._incompleteTypeMap,function(n,t){return t})},i.getEntityTypeNameForResourceName=function(t){return n(t,"resourceName").isString().check(),this._resourceEntityTypeMap[t]},i.setEntityTypeForResourceName=function(t,i){var u,r;n(t,"resourceName").isString().check();n(i,"entityTypeOrName").isInstanceOf(l).or().isString().check();u=i instanceof l?i.name:o(this,i,!0);this._resourceEntityTypeMap[t]=u;r=this._getEntityType(u,!0);r&&!r.defaultResourceName&&(r.defaultResourceName=t)},i._checkEntityType=function(n){var t,i;if(!n.entityType){if(t=n.prototype._$typeName,!t)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");i=this._getEntityType(t);i&&(n.entityType=i)}},r}(),uu=function(){function o(t,i,r){t._entityTypeResourceMap={};b(i).forEach(function(i){if(i.cSpaceOSpaceMapping){var u=JSON.parse(i.cSpaceOSpaceMapping),r={};u.forEach(function(n){r[n[0]]=n[1]});i.cSpaceOSpaceMapping=r}i.entityContainer&&b(i.entityContainer).forEach(function(r){b(r.entitySet).forEach(function(r){var u=n(r.entityType,i).typeName;t.setEntityTypeForResourceName(r.name,u);t._entityTypeResourceMap[u]=r.name})});i.complexType&&b(i.complexType).forEach(function(n){var r=h(n,i,t)});i.entityType&&b(i.entityType).forEach(function(n){var r=s(n,i,t)})});var u=t.getIncompleteNavigationProperties();if(u.length>0)throw new Error("Bad nav properties");return r&&t.importMetadata(r,!0),t}function s(i,u,f){var c=i.name,a=r(c,u),e=new l({shortName:c,namespace:a,isAbstract:i.abstract&&i.abstract==="true"}),o,h,s;return i.baseType?(o=n(i.baseType,u).typeName,e.baseTypeName=o,h=f._getEntityType(o,!0),h?t(e,i,u,f,h):(s=f._deferredTypes[o],s||(s=[],f._deferredTypes[o]=s),s.push({entityType:e,csdlEntityType:i}))):t(e,i,u,f,null),e}function t(n,i,r,f,e){var c=[],o,s,h;e&&(n.baseEntityType=e,n.autoGeneratedKeyType=e.autoGeneratedKeyType,c=e.keyProperties.map(bt("name")),e.dataProperties.forEach(function(t){var i=new k(t);i.isInherited=!0;n.addProperty(i)}),e.navigationProperties.forEach(function(t){var i=new ct(t);i.isInherited=!0;n.addProperty(i)}));o=i.key?b(i.key.propertyRef).map(bt("name")):[];o=c.concat(o);b(i.property).forEach(function(t){u(n,t,r,o)});b(i.navigationProperty).forEach(function(t){a(n,t,r)});f.addEntityType(n);n.defaultResourceName=f._entityTypeResourceMap[n.name];s=f._deferredTypes;h=s[n.name];h&&(h.forEach(function(i){t(i.entityType,i.csdlEntityType,r,f,n)}),delete s[n.name])}function h(n,t,i){var e=n.name,o=r(e,t),f=new pt({shortName:e,namespace:o});return b(n.property).forEach(function(n){u(f,n,t)}),i.addEntityType(f),f}function u(n,t,i,r){var u,e=t.type.split(".");return e.length===2?u=f(n,t,r):v(t,i)?(u=f(n,t,r),u&&(u.enumType=t.type)):u=c(n,t,i),u&&(n.addProperty(u),y(u)),u}function f(n,t,r){var f=i.fromEdmDataType(t.type),s,e,u,o;return f==null?(n.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type),null):(s=t.nullable==="true"||t.nullable==null,e=r!=null&&r.indexOf(t.name)>=0,e&&n.autoGeneratedKeyType===st.None&&p(t)&&(n.autoGeneratedKeyType=st.Identity),u=t.maxLength,u=u==null||u==="Max"?null:parseInt(u,10),o=new k({nameOnServer:t.name,dataType:f,isNullable:s,isPartOfKey:e,maxLength:u,defaultValue:t.defaultValue,concurrencyMode:t.concurrencyMode}),f===i.Undefined&&(o.rawTypeName=t.type),o)}function c(t,i,r){var u=n(i.type,r).typeName;return new k({nameOnServer:i.name,complexTypeName:u,isNullable:!1})}function a(t,i,r){var f=w(i,r),h=nt(f.end,function(n){return n.role===i.toRole}),l=h.multiplicity!=="*",a=n(h.type,r).typeName,e=f.referentialConstraint,s;if(e){var o={nameOnServer:i.name,entityTypeName:a,isScalar:l,associationName:f.name},c=e.principal,v=e.dependent,u;return i.fromRole===c.role?(u=b(c.propertyRef),o.invForeignKeyNamesOnServer=u.map(bt("name"))):(u=b(v.propertyRef),o.foreignKeyNamesOnServer=u.map(bt("name"))),s=new ct(o),t.addProperty(s),s}}function v(n,t){if(!t.enumType)return!1;var r=b(t.enumType),i=n.type.split("."),u=i[i.length-1];return r.some(function(n){return n.name===u})}function y(n){var t,r;(n.isNullable||n.validators.push(e.required()),n.isComplexProperty)||(n.dataType===i.String?n.maxLength?(r={maxLength:n.maxLength},t=e.maxLength(r)):t=e.string():t=n.dataType.validatorCtor(),n.validators.push(t))}function p(n){var i=nt(Object.keys(n),function(n){return n.indexOf("StoreGeneratedPattern")>=0}),t,r;return i?n[i]==="Identity":(t=n.extensions,!t)?!1:(r=nt(t,function(n){return n.name==="StoreGeneratedPattern"&&n.value==="Identity"}),!!r)}function w(t,i){var u=n(t.relationship,i).shortTypeName,r=i.association;return r?(Array.isArray(r)||(r=[r]),nt(r,function(n){return n.name===u})):null}function n(n,t){var e,i,u,f,o;return n?vt(n,yt.ANONTYPE_PREFIX)?{shortTypeName:n,namespace:"",typeName:n,isAnonymous:!0}:(e=n.split(",")[0],i=e.split("."),i.length>1?(u=i[i.length-1],t?f=r(u,t):(o=i.slice(0,i.length-1),f=o.join(".")),{shortTypeName:u,namespace:f,typeName:si(u,f)}):{shortTypeName:n,namespace:"",typeName:n}):null}function r(n,t){var r,u=t.cSpaceOSpaceMapping,i;return u&&(i=u[t.namespace+"."+n],r=i&&i.substr(0,i.length-(n.length+1))),r||t.namespace}var d=nu(function(t){return t&&n(t).typeName});return{parse:o,normalizeTypeName:d}}(),l=function(){function w(n,t){return n.entityAspect||n.complexAspect?n.getProperty(t.name):n[t.name]}function d(){return function(){}}function h(n){return n.filter(function(n){return!n.isInherited})}function u(n,t,i){var o=i+"OnServer",u=t[i],f,r,e;if(u&&u.length){if(t.isUnmapped)return;f=b(u).map(function(i){var r=n.clientPropertyNameToServer(i,t),u=n.serverPropertyNameToClient(r,t);if(i!==u)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+i+"-->"+u);return r});t[o]=Array.isArray(u)?f:f[0]}else{if(r=t[o],!r||r.length===0)return;e=b(r).map(function(i){var r=n.serverPropertyNameToClient(i,t),u=n.clientPropertyNameToServer(r,t);if(i!==u)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+i+"-->"+u);return r});t[i]=Array.isArray(r)?e:e[0]}}function c(n,t){var i=t._getEntityType(n.complexTypeName,!0);if(!i)return!1;if(!(i instanceof pt))throw new Error("Unable to resolve ComplexType with the name: "+n.complexTypeName+" for the property: "+property.name);return n.dataType=i,n.defaultValue=null,!0}function a(n,t){var i=t._getEntityType(n.entityTypeName,!0),r;return i?(n.entityType=i,r=nt(i.navigationProperties,function(t){return t.associationName===n.associationName&&(t.name!==n.name||t.entityTypeName!==n.entityTypeName)}),n.inverse=r,r||n.invForeignKeyNames.forEach(function(t){var r=i.getDataProperty(t),u=n.parentType;r.inverseNavigationProperty=nt(u.navigationProperties,function(n){return n.invForeignKeyNames&&n.invForeignKeyNames.indexOf(r.name)>=0});v(i.foreignKeyProperties,r)}),g(n),!0):!1}function v(n,t){var i=n.indexOf(t);i===-1&&n.push(t)}function g(n){var t=n.foreignKeyNames;if(t.length!==0){var i=n.parentType,r=t.map(function(n){return i.getDataProperty(n)}),u=i.foreignKeyProperties;r.forEach(function(t){v(u,t);t.relatedNavigationProperty=n;n.relatedDataProperties?n.relatedDataProperties.push(t):n.relatedDataProperties=[t]})}}function tt(n,t){var r=n.getPropertyNames(),u=ni.getDefaultInstance().getTrackablePropertyNames(t);u.forEach(function(t){if(r.indexOf(t)===-1){var u=new k({name:t,dataType:i.Undefined,isNullable:!0,isUnmapped:!0});n.subtypes?n.getSelfAndSubtypes().forEach(function(n){n.addProperty(new k(u))}):n.addProperty(u)}})}var y=0,f=function(n){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");n._$typeName==="MetadataStore"?(this.metadataStore=n,this.shortName="Anon_"+ ++y,this.namespace="",this.isAnonymous=!0):s(n).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(st).isOptional().withDefault(st.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this);this.name=si(this.shortName,this.namespace);this.dataProperties=[];this.navigationProperties=[];this.complexProperties=[];this.keyProperties=[];this.foreignKeyProperties=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.validators=[];this.warnings=[];this._mappedPropertiesCount=0;this.subtypes=[];lr(this,n.dataProperties,k);lr(this,n.navigationProperties,ct)},t=f.prototype,r=i.parseRawValue;return t._$typeName="EntityType",t.setProperties=function(n){s(n).whereParam("autoGeneratedKeyType").isEnumOf(st).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this);n.defaultResourceName&&(this.defaultResourceName=n.defaultResourceName)},t.isSubtypeOf=function(t){n(t,"entityType").isInstanceOf(l).check();var i=this;do{if(i===t)return!0;i=i.baseEntityType}while(i);return!1},t.getSelfAndSubtypes=function(){var n=[this];return this.subtypes.forEach(function(t){var i=t.getSelfAndSubtypes();n.push.apply(n,i)}),n},t.addProperty=function(t){if(n(t,"dataProperty").isInstanceOf(k).or().isInstanceOf(ct).check(),this.metadataStore&&!t.isUnmapped)throw new Error("The '"+this.name+"' EntityType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(t.parentType)if(t.parentType!==this)throw new Error("This dataProperty has already been added to "+t.parentType.name);else return this;return t.parentType=this,t.isDataProperty?this._addDataProperty(t):this._addNavigationProperty(t),this},t.createEntity=function(n){if(n&&n._$eref&&!n._$eref.entityAspect.entityManager)return n._$eref;var t=this._createInstanceCore();return n&&(this.keyProperties.every(function(t){return n[t.name]!=null})&&(n._$eref=t),this._updateTargetFromRaw(t,n,w),this.navigationProperties.forEach(function(i){var u,r=n[i.name],f,e;r!=undefined&&(f=i.entityType,i.isScalar?(u=r.entityAspect?r:f.createEntity(r),t.setProperty(i.name,u)):(e=t.getProperty(i.name),r.forEach(function(n){u=n.entityAspect?n:f.createEntity(n);e.push(u)})))})),this._initializeInstance(t),t},t._createInstanceCore=function(){var t=this.getEntityCtor(),n=new t;return new ot(n),n},t._initializeInstance=function(n){this.baseEntityType&&this.baseEntityType._initializeInstance(n);var t=this.initFn;t&&(typeof t=="string"&&(t=n[t]),t(n));this.complexProperties&&this.complexProperties.forEach(function(t){var i=n.getProperty(t.name);Array.isArray(i)?i.forEach(function(n){t.dataType._initializeInstance(n)}):t.dataType._initializeInstance(i)});n.entityAspect&&(n.entityAspect._initialized=!0)},t.getCtor=t.getEntityCtor=function(n){var r;if(this._ctor&&!n)return this._ctor;var u=this.metadataStore._ctorRegistry,i=u[this.name]||u[this.shortName]||{},t=i.ctor||this._ctor;if(t&&t.prototype.entityType&&t.prototype.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");return i.ctor&&n&&(this._extra=undefined),t||(r=ni.getDefaultInstance().createCtor,t=r?r(this):d()),this.initFn=i.initFn,this.noTrackingFn=i.noTrackingFn,t.prototype._$typeName=this.name,this._setCtor(t),t},t._setCtor=function(n,t){var i=n.prototype,r;this._extra=this._extra||{};r=new n;tt(this,r);this._$typeName==="EntityType"?i.entityType=this:i.complexType=this;i._$interceptor=t||au;ni.getDefaultInstance().initializeEntityPrototype(i);this._ctor=n},t.addValidator=function(t,i){n(t,"validator").isInstanceOf(e).check();n(i,"property").isOptional().isString().or().isEntityProperty().check();i?(typeof i=="string"&&(i=this.getProperty(i,!0)),i.validators.push(t)):this.validators.push(t)},t.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},t.getPropertyNames=function(){return this.getProperties().map(bt("name"))},t.getDataProperty=function(n,t){var i=t?"nameOnServer":"name";return nt(this.dataProperties,pi(i,n))},t.getNavigationProperty=function(n,t){var i=t?"nameOnServer":"name";return nt(this.navigationProperties,pi(i,n))},t.getProperty=function(n,t){var f;t=t||!1;var r=Array.isArray(n)?n:n.trim().split("."),u=r[0],i=nt(this.getProperties(),pi("name",u));if(r.length===1){if(i)return i;if(t)throw new Error("unable to locate property: "+u+" on entityType: "+this.name);else return null}else if(i){if(r.shift(),f=i.isNavigationProperty?i.entityType:i.dataType,f)return f.getProperty(r,t);throw new Error("should not get here - unknown property type for: "+i.name);}else if(t)throw new Error("unable to locate property: "+u+" on type: "+this.name);else return null},t.getEntityKeyFromRawEntity=function(n,t){var i=this.keyProperties.map(function(i){var u=t(n,i);return r(u,i.dataType)});return new o(this,i)},t._updateTargetFromRaw=function(n,t,i){this.dataProperties.forEach(function(u){var f=i(t,u),e,o,s;if(f!==undefined)if(e=u.dataType,u.isComplexProperty){if(f===null)return;o=n.getProperty(u.name);u.isScalar?e._updateTargetFromRaw(o,f,i):(o.length=0,Array.isArray(f)&&f.forEach(function(t){var r=e._createInstanceCore(n,u);e._updateTargetFromRaw(r,t,i);e._initializeInstance(r);o.push(r)}))}else u.isScalar?(s=r(f,e),n.setProperty(u.name,s)):(o=n.getProperty(u.name),o.length=0,Array.isArray(f)&&f.forEach(function(n){s=r(n,e);o.push(s)}))});var u=t.entityAspect||t.complexAspect;u&&u.originalValuesMap&&(targetAspect=n.entityAspect||n.complexAspect,targetAspect.originalValues=u.originalValuesMap)},t.toString=function(){return this.name},t.toJSON=function(){return kt(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:h,navigationProperties:h,validators:null,custom:null})},t._clientPropertyPathToServer=function(n){var t=this.metadataStore.namingConvention.clientPropertyNameToServer,i=this;return n.split(".").map(function(n){var r=i.getProperty(n);return t(n,r)}).join("/")},t._updateNames=function(n){var t=this.metadataStore.namingConvention;u(t,n,"name");n.isNavigationProperty&&(u(t,n,"foreignKeyNames"),u(t,n,"invForeignKeyNames"))},t._checkNavProperty=function(n){if(n.isNavigationProperty){if(n.parentType!==this)throw new Error(p("The navigationProperty '%1' is not a property of entity type '%2'",n.name,this.name));return n}if(typeof n=="string"){var t=this.getProperty(n);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty");},t._addDataProperty=function(n){this.dataProperties.push(n);n.isPartOfKey&&this.keyProperties.push(n);n.isComplexProperty&&this.complexProperties.push(n);n.concurrencyMode&&n.concurrencyMode!=="None"&&this.concurrencyProperties.push(n);n.isUnmapped&&this.unmappedProperties.push(n)},t._addNavigationProperty=function(n){this.navigationProperties.push(n);fu(n.entityTypeName)||(n.entityTypeName=si(n.entityTypeName,this.namespace))},t._updateCps=function(){var n=this.metadataStore,t=n._incompleteComplexTypeMap;this.complexProperties.forEach(function(i){i.complexType||c(i,n)||di(t,i.complexTypeName).push(i)});this.isComplexType&&((t[this.name]||[]).forEach(function(t){c(t,n)}),delete t[this.name])},t._updateNps=function(){var n=this.metadataStore,t=n._incompleteTypeMap;this.navigationProperties.forEach(function(i){i.entityType||a(i,n)||di(t,i.entityTypeName).push(i)});(t[this.name]||[]).forEach(function(t){a(t,n)});delete t[this.name]},f}(),pt=function(){var i=function(n){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");s(n).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().isBoolean().applyAll(this);this.name=si(this.shortName,this.namespace);this.isComplexType=!0;this.dataProperties=[];this.complexProperties=[];this.validators=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.navigationProperties=[];this.keyProperties=[];lr(this,n.dataProperties,k)},t=i.prototype;return t.setProperties=function(n){s(n).whereParam("custom").isOptional().applyAll(this)},t._createInstanceCore=function(n,t){var r=this.getCtor(),i=new r;return new ei(i,n,t),i},t.addProperty=function(t){if(n(t,"dataProperty").isInstanceOf(k).check(),this.metadataStore&&!t.isUnmapped)throw new Error("The '"+this.name+"' ComplexType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(t.parentType)if(t.parentType!==this)throw new Error("This dataProperty has already been added to "+property.parentType.name);else return this;return this._addDataProperty(t),this},t.getProperties=function(){return this.dataProperties},t=h(t,l.prototype,["addValidator","getProperty","getPropertyNames","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_setCtor"]),t.createInstance=l.prototype.createEntity,t.getCtor=l.prototype.getEntityCtor,t.toJSON=function(){return kt(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},t._$typeName="ComplexType",i}(),k=function(){var n=function(n){var r,t;if(s(n).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(i).isOptional().or().isString().or().isInstanceOf(pt).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(e).isArray().isOptional().withDefault([]).whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this),r=!!(this.name||this.nameOnServer),!r)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if(typeof this.dataType=="string"){if(t=i.fromName(this.dataType),!t)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=t}else this.dataType||(this.dataType=i.String);if(this.defaultValue==null)if(this.isNullable)this.defaultValue=null;else if(!this.isComplexProperty)if(this.dataType===i.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,this.defaultValue==null)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+this.name);this.isComplexProperty&&(this.isScalar=this.isScalar==null||this.isScalar===!0)},t=n.prototype;return t._$typeName="DataProperty",n.getRawValueFromServer=function(n,t){if(t.isUnmapped)return n[t.nameOnServer||t.name];var i=n[t.nameOnServer];return i!==undefined?i:t.defaultValue},n.getRawValueFromClient=function(n,t){var i=n[t.name];return i!==undefined?i:t.defaultValue},t.isDataProperty=!0,t.isNavigationProperty=!1,t.setProperties=function(n){s(n).whereParam("custom").isOptional().applyAll(this)},t.toJSON=function(){return kt(this,{name:null,dataType:function(n){return n&&n.parentEnum?n.name:undefined},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,concurrencyMode:null,maxLength:null,validators:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},n.fromJSON=function(n){return n.dataType=i.fromName(n.dataType),n.defaultValue&&n.dataType&&n.dataType.isDate&&(n.defaultValue=new Date(Date.parse(n.defaultValue))),n.validators&&(n.validators=n.validators.map(e.fromJSON)),new k(n)},n}(),ct=function(){var t=function(n){s(n).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(e).isArray().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this);var t=!!(this.name||this.nameOnServer);if(!t)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property");},n=t.prototype;return n._$typeName="NavigationProperty",n.isDataProperty=!1,n.isNavigationProperty=!0,n.setProperties=function(n){s(n).whereParam("custom").isOptional().applyAll(this)},n.toJSON=function(){return kt(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},t.fromJSON=function(n){return n.validators&&(n.validators=n.validators.map(e.fromJSON)),new ct(n)},t}(),st=function(){var n=new et("AutoGeneratedKeyType");return n.None=n.addSymbol(),n.Identity=n.addSymbol(),n.KeyGenerator=n.addSymbol(),n.seal(),n}();(function(){function t(n,t){return t==null?!1:t.entityType!==undefined}function i(n,t){return t==null?!1:t.isDataProperty||t.isNavigationProperty}var n=ir.prototype;n.isEntity=function(){return this._addContext({fn:t,msg:" must be an entity"})};n.isEntityProperty=function(){return this._addContext({fn:i,msg:" must be either a DataProperty or a NavigationProperty"})}})();t.MetadataStore=yt;t.EntityType=l;t.ComplexType=pt;t.DataProperty=k;t.NavigationProperty=ct;t.AutoGeneratedKeyType=st;yt.normalizeTypeName=uu.normalizeTypeName;ar=function(){function i(n,t,i){var u=t.name+".."+t.parentType.name,r=n._tempIdMap[u];return r||i&&(r={entityType:t.parentType,propertyName:t.name,keyMap:{}},n._tempIdMap[u]=r),r}var n=function(){this._tempIdMap={}},t=n.prototype;return t.generateTempKeyValue=function(n,t){var o=n.keyProperties,e,f,r,u;if(o.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");if(e=o[0],f=i(this,e,!0),t!=null&&(f.keyMap[t.toString()]||(r=t)),r===undefined)if(u=e.dataType,u.getNext)for(r=u.getNext(this);f.keyMap[r.toString()]!=null;)r=u.getNext(this);else throw new Error("Cannot use a property with a dataType of: "+u.toString()+" for id generation");return f.keyMap[r.toString()]=!0,r},t.getTempKeys=function(){var t=[],i,n,r,u;for(i in this._tempIdMap){n=this._tempIdMap[i];r=n.entityType;for(u in n.keyMap)t.push(new o(r,[u]))}return t},t.isTempKey=function(n){var r=n.entityType.keyProperties,u,t;return r.length>1?!1:(u=r[0],t=i(this,u),!t)?!1:t.keyMap[n.values[0].toString()]!==undefined},y.registerType(n,"KeyGenerator"),n}();t.KeyGenerator=ar;hi=function(){var n=function(n){s(n||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this);this.name||(this.name=fi());y._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="LocalQueryComparisonOptions",n.caseInsensitiveSQL=new n({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),n.defaultInstance=new n(n.caseInsensitiveSQL),t.setAsDefault=function(){return ui(this,n)},n}();t.LocalQueryComparisonOptions=hi;ci=function(){var n=function(n){s(n||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this);this.name||(this.name=fi());y._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="NamingConvention",n.none=new n({name:"noChange",serverPropertyNameToClient:function(n){return n},clientPropertyNameToServer:function(n){return n}}),n.camelCase=new n({name:"camelCase",serverPropertyNameToClient:function(n){return n.substr(0,1).toLowerCase()+n.substr(1)},clientPropertyNameToServer:function(n){return n.substr(0,1).toUpperCase()+n.substr(1)}}),n.defaultInstance=new n(n.none),t.setAsDefault=function(){return ui(this,n)},n}();t.NamingConvention=ci;var rt=function(){function f(n,t,i,r){var o=i._$typeName||i.parentEnum&&i.parentEnum.name,u=o&&o.substr(0,1).toLowerCase()+o.substr(1),e;if(r&&u!=r)throw new Error("Invalid value for property: "+r);if(u)if(e=t[u],e===undefined)throw new Error("Invalid config property: "+u);else e===null?n[u]=i:e(n,i);else it(i,function(i,r){f(n,t,r,i)})}function i(n,t,i){return t&&n[t]===i?n:(copy=h(new rt,n,["resourceName","entityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","queryOptions","entityManager","dataService","resultEntityType"]),copy.parameters=h({},n.parameters),t&&(copy[t]=i),copy)}function u(t){return n(t,"propertyPaths").isOptional().isString().or().isArray().isString().check(),typeof t=="string"&&(t=t.split(",")),t.map(function(n){return n.trim()})}function a(n){var t=n.entityType,i=t.keyProperties.map(function(t){return w.create(t.name,v.Equals,n.getProperty(t.name))});return w.and(i)}function e(n,t,r){var f;return t==null?f=null:(t=u(t),f=yi.create(t,r),n.orderByClause&&(f=n.orderByClause.addClause(f))),i(n,"orderByClause",f)}function s(n){var t=n.entityType.keyProperties,i=ki(t,n.values,function(n,t){return w.create(n.name,v.Equals,t)});return w.and(i)}function y(n,t){var u,f,i,r,e,h;return t.isScalar?t.foreignKeyNames.length===0?null:(u=t.foreignKeyNames.map(function(t){return n.getProperty(t)}),f=new o(t.entityType,u),s(f)):(i=t.inverse,r=i?i.foreignKeyNames:t.invForeignKeyNames,r.length===0)?null:(e=n.entityAspect.getKey().values,h=ki(r,e,function(n,t){return w.create(n,v.Equals,t)}),w.and(h))}var r=function(t){n(t,"resourceName").isOptional().isString().check();this.resourceName=t;this.entityType=null;this.wherePredicate=null;this.orderByClause=null;this.selectClause=null;this.skipCount=null;this.takeCount=null;this.expandClause=null;this.parameters={};this.inlineCountEnabled=!1;this.noTrackingEnabled=!1;this.entityManager=null},t=r.prototype;return t._$typeName="EntityQuery",t.from=function(t){return n(t,"resourceName").isString().check(),i(this,"resourceName",t)},r.from=function(t){return n(t,"resourceName").isString().check(),new rt(t)},t.toType=function(t){return n(t,"entityType").isString().or().isInstanceOf(l).check(),i(this,"resultEntityType",t)},t.where=function(n){var t;return n==null?t=null:(t=n instanceof w?n:w.create(d(arguments)),this.entityType&&t.validate(this.entityType),this.wherePredicate&&(t=new vi("and",[this.wherePredicate,t]))),i(this,"wherePredicate",t)},t.orderBy=function(n){return e(this,n)},t.orderByDesc=function(n){return e(this,n,!0)},t.select=function(n){var t=n==null?null:new yu(u(n));return i(this,"selectClause",t)},t.skip=function(t){return n(t,"count").isOptional().isNumber().check(),i(this,"skipCount",t==null?null:t)},t.top=function(n){return this.take(n)},t.take=function(t){return n(t,"count").isOptional().isNumber().check(),i(this,"takeCount",t==null?null:t)},t.expand=function(n){var t=n==null?null:new pu(u(n));return i(this,"expandClause",t)},t.withParameters=function(t){return n(t,"parameters").isObject().check(),i(this,"parameters",t)},t.inlineCount=function(t){return n(t,"enabled").isBoolean().isOptional().check(),t=t===undefined?!0:!!t,i(this,"inlineCountEnabled",t)},t.noTracking=function(t){return n(t,"enabled").isBoolean().isOptional().check(),t=t===undefined?!0:!!t,i(this,"noTrackingEnabled",t)},t.using=function(n){if(!n)return this;var t=i(this);return f(t,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(n,t){n.queryOptions=(n.queryOptions||new ut).using(t)},mergeStrategy:function(n,t){n.queryOptions=(n.queryOptions||new ut).using(t)},jsonResultsAdapter:function(n,t){n.dataService=(n.dataService||new c).using({jsonResultsAdapter:t})}},n),t},t.execute=function(n,t){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,n,t)},t.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},r.fromEntities=function(t){var r;n(t,"entities").isEntity().or().isNonEmptyArray().isEntity().check();Array.isArray(t)||(t=d(arguments));var u=t[0],i=new rt(u.entityType.defaultResourceName),f=t.map(function(n){return a(n)}),e=w.or(f);return i=i.where(e),r=u.entityAspect.entityManager,r&&(i=i.using(r)),i},r.fromEntityKey=function(t){n(t,"entityKey").isInstanceOf(o).check();var i=new rt(t.entityType.defaultResourceName),r=s(t);return i.where(r)},r.fromEntityNavigation=function(t,i){var u;n(t,"entity").isEntity().check();var f=t.entityType._checkNavProperty(i),r=new rt(f.entityType.defaultResourceName),e=y(t,f);return r=r.where(e),u=t.entityAspect.entityManager,u&&(r=r.using(u)),r},t._getFromEntityType=function(n,t){var i=this.entityType,r,u;if(i)return i;if(r=this.resourceName,!r)throw new Error("There is no resourceName for this query");if(n.isEmpty())if(t)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");else return null;if(u=n.getEntityTypeNameForResourceName(r),i=u?n._getEntityType(u):this._getToEntityType(n,!0),!i)if(t)throw new Error(p("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",r));else return null;return this.entityType=i,i},t._getToEntityType=function(n,t){return this.resultEntityType instanceof l?this.resultEntityType:this.resultEntityType?(this.resultEntityType=n._getEntityType(this.resultEntityType,!1),this.resultEntityType):t?null:!this.selectClause&&this._getFromEntityType(n,!1)},t._toUri=function(n){function f(){var n=t.wherePredicate;if(n)return t.entityType&&n.validate(t.entityType),w._next=0,n.toODataFragment(r)}function e(){if(t.inlineCountEnabled)return t.inlineCountEnabled?"allpages":"none"}function o(){var n=t.orderByClause;if(n)return t.entityType&&n.validate(t.entityType),n.toODataFragment(r)}function s(){var n=t.selectClause;if(n)return t.entityType&&n.validate(t.entityType),n.toODataFragment(r)}function h(){var n=t.expandClause;if(n)return n.toODataFragment(r)}function c(){var n=t.skipCount;if(n)return n.toString()}function a(){var n=t.takeCount;if(n!=null)return n.toString()}function v(n){var i=[],r,t;for(r in n)t=n[r],t!==undefined&&(t instanceof Array?t.forEach(function(n){i.push(r+"="+encodeURIComponent(n))}):i.push(r+"="+encodeURIComponent(t)));return i.length>0?"?"+i.join("&"):""}var r=this._getFromEntityType(n,!1),t,i,u;return r||(r=new l(n)),t=this,i={},i.$filter=f(),i.$orderby=o(),i.$skip=c(),i.$top=a(),i.$expand=h(),i.$select=s(),i.$inlinecount=e(),u=v(i),this.resourceName+u},t._toFilterFunction=function(n){var t=this.wherePredicate;return t?(t.validate(n),t.toFunction(n)):null},t._toOrderByComparer=function(n){var t=this.orderByClause;return t?t.getComparer(n):null},r}(),vu=function(){return{toupper:{fn:function(n){return n.toUpperCase()},dataType:i.String},tolower:{fn:function(n){return n.toLowerCase()},dataType:i.String},substring:{fn:function(n,t,i){return n.substring(t,i)},dataType:i.String},substringof:{fn:function(n,t){return t.indexOf(n)>=0},dataType:i.Boolean},length:{fn:function(n){return n.length},dataType:i.Int32},trim:{fn:function(n){return n.trim()},dataType:i.String},concat:{fn:function(n,t){return n.concat(t)},dataType:i.String},replace:{fn:function(n,t,i){return n.replace(t,i)},dataType:i.String},startswith:{fn:function(n,t){return vt(n,t)},dataType:i.Boolean},endswith:{fn:function(n,t){return cr(n,t)},dataType:i.Boolean},indexof:{fn:function(n,t){return n.indexOf(t)},dataType:i.Int32},round:{fn:function(n){return Math.round(n)},dataType:i.Int32},ceiling:{fn:function(n){return Math.ceil(n)},dataType:i.Int32},floor:{fn:function(n){return Math.floor(n)},dataType:i.Int32},second:{fn:function(n){return n.second},dataType:i.Int32},minute:{fn:function(n){return n.minute},dataType:i.Int32},day:{fn:function(n){return n.day},dataType:i.Int32},month:{fn:function(n){return n.month},dataType:i.Int32},year:{fn:function(n){return n.year},dataType:i.Int32}}}(),li=function(){function e(n){var t=n.split(".");return t.length===1?function(t){return t.getProperty(n)}:function(n){return ur(n,t)}}var r=/^[a-z_][\w.$]*$/i,u=/('[^']*'|[^,]+)/g,f=/("[^"]*"|[^,]+)/g,n=function(n,t,o){var c=n.split(":"),s,l,y,p,w,a,v,h,b,k;if(this.isRealNode=!0,c.length===1)if(s=c[0].trim(),this.value=s,l=s.substr(0,1),y=l==="'"||l==='"',y)p=s.substr(1,s.length-2),this.fn=function(){return p},this.dataType=i.String;else if(w=r.test(s),w){if(o&&o.getProperty(s,!1)==null){this.isRealNode=!1;return}this.propertyPath=s;this.fn=e(s)}else{if(o){this.isRealNode=!1;return}this.fn=function(){return s};this.dataType=i.fromValue(s)}else try{this.fnName=c[0].trim().toLowerCase();a=vu[this.fnName];this.localFn=a.fn;this.dataType=a.dataType;v=this;this.fn=function(n){var t=v.fnNodes.map(function(t){return t.fn(n)});return v.localFn.apply(null,t)};h=t[c[1]].trim();h.substr(0,1)==="("&&(h=h.substr(1,h.length-2));b=n.indexOf("'")>=0?u:f;k=h.match(b);this.fnNodes=k.map(function(n){return new li(n,t)})}catch(d){this.isRealNode=!1}},t=n.prototype;return n.create=function(n,t,r){var f,s,u;if(typeof n!="string")return null;for(var e,o=[],h=0;e=/\([^()]*\)/.exec(n);)f=e[0],o.push(f),s=":"+h++,n=n.replace(f,s);return u=new li(n,o,r?null:t),u.isRealNode?(!u.dataType&&r&&r.isStringFn&&(u.dataType=i.String),u._validate(t),u):null},t.toString=function(){if(this.fnName){var n=this.fnNodes.map(function(n){return n.toString()});return this.fnName+"("+n.join(",")+")"}return this.value},t.toODataFragment=function(n){var i,r,t;return this._validate(n),this.fnName?(i=this.fnNodes.map(function(t){return t.toODataFragment(n)}),r=this.fnName+"("+i.join(",")+")",r):(t=this.value.substr(0,1),t==="'"||t==='"'?this.value:this.value==this.propertyPath?n._clientPropertyPathToServer(this.propertyPath):this.value)},t._validate=function(n){var t,i;if(!this.isValidated)if(this.isValidated=!0,this.propertyPath){if(n.isAnonymous)return;if(t=n.getProperty(this.propertyPath,!0),!t){i=p("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",n.name,this.propertyPath);throw new Error(i);}this.dataType=t.isDataProperty?t.dataType:t.entityType}else this.fnNodes&&this.fnNodes.forEach(function(t){t._validate(n)})},n}(),v=function(){var n=new et("FilterQueryOp");return n.Equals=n.addSymbol({operator:"eq",aliases:["=="]}),n.NotEquals=n.addSymbol({operator:"ne",aliases:["!="]}),n.GreaterThan=n.addSymbol({operator:"gt",aliases:[">"]}),n.LessThan=n.addSymbol({operator:"lt",aliases:["<"]}),n.GreaterThanOrEqual=n.addSymbol({operator:"ge",aliases:[">="]}),n.LessThanOrEqual=n.addSymbol({operator:"le",aliases:["<="]}),n.Contains=n.addSymbol({operator:"substringof",isFunction:!0,isStringFn:!0}),n.StartsWith=n.addSymbol({operator:"startswith",isFunction:!0,isStringFn:!0}),n.EndsWith=n.addSymbol({operator:"endswith",isFunction:!0,isStringFn:!0}),n.Any=n.addSymbol({operator:"any",isAnyAll:!0,aliases:["some"]}),n.All=n.addSymbol({operator:"all",isAnyAll:!0,aliases:["every"]}),n.IsTypeOf=n.addSymbol({operator:"isof",isFunction:!0,aliases:["isTypeOf"]}),n.seal(),n._map=function(){var t={};return n.getSymbols().forEach(function(n){t[n.name.toLowerCase()]=n;t[n.operator.toLowerCase()]=n;n.aliases&&n.aliases.forEach(function(i){t[i.toLowerCase()]=n})}),t}(),n.from=function(t){return n.contains(t)?t:n._map[t.toLowerCase()]},n}(),ai=function(){var n=new et("BooleanQueryOp");return n.And=n.addSymbol({operator:"and",aliases:["&&"]}),n.Or=n.addSymbol({operator:"or",aliases:["||"]}),n.Not=n.addSymbol({operator:"not",aliases:["~","!"]}),n.seal(),n._map=function(){var t={};return n.getSymbols().forEach(function(n){t[n.name.toLowerCase()]=n;t[n.operator.toLowerCase()]=n;n.aliases&&n.aliases.forEach(function(i){t[i.toLowerCase()]=n})}),t}(),n.from=function(t){return n.contains(t)?t:n._map[t.toLowerCase()]},n}(),w=function(){function t(n){var t;return n.length===1&&Array.isArray(n[0])?t=n[0]:(t=d(n),t[0]instanceof w||(t=[w.create(t)])),t.filter(function(n){return n!=null})}var n=function(){return arguments[0].prototype===!0?this:new vr(d(arguments))},i=n.prototype;return n.create=function(n){var t=Array.isArray(n)&&arguments.length===1?n:d(arguments);return new vr(t)},n.and=function(n){return n=t(arguments),n.length===0?null:n.length===1?n[0]:new vi("and",n)},n.or=function(n){return n=t(arguments),n.length===0?null:n.length===1?n[0]:new vi("or",n)},n.not=function(n){return new vi("not",[n])},i.and=function(i){return i=t(arguments),i.unshift(this),n.and(i)},i.or=function(i){return i=t(arguments),i.unshift(this),n.or(i)},i.not=function(){return new vi("not",[this])},n}(),vr=function(){function f(n,t,i){var h=n.metadataStore.localQueryComparisonOptions,r=eu(i),f;switch(t){case v.Equals:f=function(n,t){return n&&typeof n=="string"?u(n,t,h):r(n)==r(t)};break;case v.NotEquals:f=function(n,t){return n&&typeof n=="string"?!u(n,t,h):r(n)!=r(t)};break;case v.GreaterThan:f=function(n,t){return r(n)>r(t)};break;case v.GreaterThanOrEqual:f=function(n,t){return r(n)>=r(t)};break;case v.LessThan:f=function(n,t){return r(n)<r(t)};break;case v.LessThanOrEqual:f=function(n,t){return r(n)<=r(t)};break;case v.StartsWith:f=function(n,t){return e(n,t,h)};break;case v.EndsWith:f=function(n,t){return o(n,t,h)};break;case v.Contains:f=function(n,t){return s(n,t,h)};break;case v.Any:f=function(n,t){return n.some(function(n){return t(n)})};break;case v.All:f=function(n,t){return n.every(function(n){return t(n)})};break;default:throw new Error("Unknown FilterQueryOp: "+t);}return f}function u(n,t,i){return t==null?!1:(typeof t!="string"&&(t=t.toString()),i.usesSql92CompliantStringComparison&&(n=(n||"").trim(),t=(t||"").trim()),i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),n===t)}function e(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),vt(n,t)}function o(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),cr(n,t)}function s(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),n.indexOf(t)>=0}var r=function(t){var f,e,u,r;if(t.length===1){this._odataExpr=t[0];return}if(f=t[0],n(f,"propertyOrExpr").isString().isOptional().check(),e=t[1],n(e,"operator").isEnumOf(v).or().isString().check(),u=v.from(e),!u)throw new Error("Unknown query operation: "+e);if(this._filterQueryOp=u,f)this._propertyOrExpr=f;else if(u!==v.IsTypeOf)throw new Error("propertyOrExpr cannot be null except when using the 'IsTypeOf' operator");if(r=t[2],u&&u.isAnyAll){this._value=r instanceof w?r:new vr(t.slice(2));this._isLiteral=undefined;return}n(r,"value").isRequired(!0).check();r!=null&&typeof r=="object"&&r.value!==undefined?(this._dataType=r.dataType||i.fromValue(r.value),this._value=r.value,this._isLiteral=r.isLiteral):(this._dataType=i.fromValue(r),this._value=r,this._isLiteral=undefined)},t=new w({prototype:!0});return r.prototype=t,t.toODataFragment=function(n,t){var r,e,o,s,u,f,h;return this._odataExpr?this._odataExpr:(r=this._filterQueryOp,e=this._value,r==v.IsTypeOf)?(o=n.metadataStore.getEntityType(e),s=o.namespace+"."+o.shortName,r.operator+"("+i.String.fmtOData(s)+")"):(this.validate(n),u=this._fnNode1&&this._fnNode1.toODataFragment(n),t&&(u=t+"/"+u),w._next+=1,t="x"+w._next,r.isAnyAll?u+"/"+r.operator+"("+t+": "+e.toODataFragment(this.dataType,t)+")":(this._fnNode2?f=this._fnNode2.toODataFragment(n):(h=this._fnNode1.dataType||this._dataType,f=h.fmtOData(e)),r.isFunction?r==v.Contains?r.operator+"("+f+","+u+") eq true":r.operator+"("+u+","+f+") eq true":u+" "+r.operator+" "+f))},t.toFunction=function(n){var u,e,o;if(this._odataExpr)throw new Exception("OData predicateexpressions cannot be interpreted locally");this.validate(n);var r=this._fnNode1.dataType||this._dataType,t=f(n,this._filterQueryOp,r),i=this._fnNode1.fn;return this._fnNode2?(u=this._fnNode2.fn,function(n){return t(i(n),u(n))}):this._filterQueryOp&&this._filterQueryOp.isAnyAll?(e=this._value.toFunction(r),function(n){return t(i(n),e)}):(o=this._value,function(n){return t(i(n),o)})},t.toString=function(){return p("{%1} %2 {%3}",this._propertyOrExpr,this._filterQueryOp.operator,this._value)},t.validate=function(n){var t=this._filterQueryOp;if(this._fnNode1===undefined&&this._propertyOrExpr&&(this._fnNode1=li.create(this._propertyOrExpr,n,t),this.dataType=this._fnNode1.dataType),t&&t.isAnyAll){this._value.validate(this.dataType);return}this._fnNode2!==undefined||this._isLiteral||(this._fnNode2=li.create(this._value,n))},r}(),vi=function(){function i(n,t,i){var u,r;switch(t){case ai.Not:return u=i[0].toFunction(n),function(n){return!u(n)};case ai.And:return r=i.map(function(t){return t.toFunction(n)}),function(n){return r.reduce(function(t,i){return t&&i(n)},!0)};case ai.Or:return r=i.map(function(t){return t.toFunction(n)}),function(n){return r.reduce(function(t,i){return t||i(n)},!1)};default:throw new Error("Invalid boolean operator:"+t);}}var t=function(n,t){if(!Array.isArray(t))throw new Error("predicates parameter must be an array");if(this._booleanQueryOp=ai.from(n),!this._booleanQueryOp)throw new Error("Unknown query operation: "+n);if(this._booleanQueryOp===ai.Not&&t.length!==1)throw new Error("Only a single predicate can be passed in with the 'Not' operator");this._predicates=t},n=new w({prototype:!0});return t.prototype=n,n.toODataFragment=function(n,t){return this._predicates.length==1?this._booleanQueryOp.operator+" ("+this._predicates[0].toODataFragment(n,t)+")":this._predicates.map(function(i){return"("+i.toODataFragment(n,t)+")"}).join(" "+this._booleanQueryOp.operator+" ")},n.toFunction=function(n){return i(n,this._booleanQueryOp,this._predicates)},n.toString=function(){return this._predicates.length==1?this._booleanQueryOp.operator+" ("+this._predicates[0]+")":this._predicates.map(function(n){return"("+n.toString()+")"}).join(" "+this._booleanQueryOp.operator+" ")},n.validate=function(n){this._isValidated||(this._predicates.every(function(t){t.validate(n)}),this._isValidated=!0)},t}(),yi=function(){var n=function(t,i){return t.prototype===!0?this:n.create(t,i)},t=n.prototype;return n.create=function(n,t){if(n.length>1){var i=n.map(function(n){return new yr(n,t)});return new rr(i)}return new yr(n[0],t)},n.combine=function(n){return new rr(n)},n.isOrderByClause=function(n){return n instanceof yi},t.addClause=function(n){return new rr([this,n])},n}(),yr=function(){var t=function(n,t){var i,r;if(!(typeof n=="string"))throw new Error("propertyPath is not a string");if(n=n.trim(),i=n.split(" "),i.length>1&&t!==!0&&t!==!1&&(t=vt(i[1].toLowerCase(),"desc"),!t&&(r=vt(i[1].toLowerCase(),"asc"),!r)))throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'");this.propertyPath=i[0];this.isDesc=t},n=new yi({prototype:!0});return t.prototype=n,n.validate=function(n){n&&(this.lastProperty=n.getProperty(this.propertyPath,!0))},n.toODataFragment=function(n){return n._clientPropertyPathToServer(this.propertyPath)+(this.isDesc?" desc":"")},n.getComparer=function(n){var u,f,t,r;return this.lastProperty||this.validate(n),this.lastProperty&&(u=this.lastProperty.dataType,f=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive),t=this.propertyPath,r=this.isDesc,function(n,e){var o=ur(n,t),s=ur(e,t),c=u||o&&i.fromValue(o)||i.fromValue(s),h;return c===i.String?f?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase()):(h=eu(c),o=h(o),s=h(s)),o===s?0:o>s||s===undefined?r?-1:1:r?1:-1}},t}(),rr=function(){var t=function(n){var t=[];n.forEach(function(n){if(n instanceof rr)t=t.concat(n.orderByClauses);else if(n instanceof yr)t.push(n);else throw new Error("Invalid argument to CompositeOrderByClause ctor.");});this._orderByClauses=t},n=new yi({prototype:!0});return t.prototype=n,n.validate=function(n){this._orderByClauses.forEach(function(t){t.validate(n)})},n.toODataFragment=function(n){var t=this._orderByClauses.map(function(t){return t.toODataFragment(n)});return t.join(",")},n.getComparer=function(n){var t=this._orderByClauses.map(function(t){return t.getComparer(n)});return function(n,i){for(var u,r=0;r<t.length;r++)if(u=t[r](n,i),u!==0)return u;return 0}},t}(),yu=function(){var t=function(n){this.propertyPaths=n;this._pathNames=n.map(function(n){return n.replace(".","_")})},n=t.prototype;return n.validate=function(n){n&&this.propertyPaths.forEach(function(t){n.getProperty(t,!0)})},n.toODataFragment=function(n){return this.propertyPaths.map(function(t){return n._clientPropertyPathToServer(t)}).join(",")},n.toFunction=function(){var n=this;return function(t){var i={};return n.propertyPaths.forEach(function(r,u){i[n._pathNames[u]]=ur(t,r)}),i}},t}(),pu=function(){var n=function(n){this.propertyPaths=n},t=n.prototype;return t.toODataFragment=function(n){return this.propertyPaths.map(function(t){return n._clientPropertyPathToServer(t)}).join(",")},n}();t.FilterQueryOp=v;t.Predicate=w;t.EntityQuery=rt;t.FnNode=li;t.OrderByClause=yi;var a=function(){var n=new et("MergeStrategy");return n.PreserveChanges=n.addSymbol(),n.OverwriteChanges=n.addSymbol(),n.SkipMerge=n.addSymbol(),n.Disallowed=n.addSymbol(),n.seal(),n}(),ri=function(){var n=new et("FetchStrategy");return n.FromServer=n.addSymbol(),n.FromLocalCache=n.addSymbol(),n.seal(),n}(),ut=function(){function i(n,t){return t&&s(t).whereParam("fetchStrategy").isEnumOf(ri).isOptional().whereParam("mergeStrategy").isEnumOf(a).isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="QueryOptions",n.resolve=function(n){return new ut(dr(n,["fetchStrategy","mergeStrategy"]))},n.defaultInstance=new n({fetchStrategy:ri.FromServer,mergeStrategy:a.PreserveChanges}),t.using=function(n){if(!n)return this;var t=new ut(this);return a.contains(n)?n={mergeStrategy:n}:ri.contains(n)&&(n={fetchStrategy:n}),i(t,n)},t.setAsDefault=function(){return ui(this,n)},t.toJSON=function(){return kt(this,{fetchStrategy:null,mergeStrategy:null})},n.fromJSON=function(n){return new ut({fetchStrategy:ri.fromName(n.fetchStrategy),mergeStrategy:a.fromName(n.mergeStrategy)})},n}();return t.QueryOptions=ut,t.FetchStrategy=ri,t.MergeStrategy=a,ou=function(){function i(n){if(n){if(n.length===1){var t=n[0];return function(n){return n?n.entityAspect.entityState===t:!1}}return function(t){return t?n.some(function(n){return t.entityAspect.entityState===n}):!1}}return function(n){return!!n}}var r=i([u.Added,u.Modified,u.Deleted]),t=function(n,t){this.entityManager=n;this.entityType=t;this._indexMap={};this._entities=[];this._emptyIndexes=[]},n=t.prototype;return n.attachEntity=function(n,t,i){var r=n.entityAspect,e,u,f,o;if(r._initialized||this.entityType._initializeInstance(n),delete r._initialized,e=r.getKey()._keyInGroup,u=this._indexMap[e],u>=0){if(f=this._entities[u],o=f.entityAspect.entityState.isUnchanged(),f===n)r.entityState=t;else if(i===a.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+r.getKey());else(i===a.OverwriteChanges||i===a.PreserveChanges&&o)&&(this.entityType._updateTargetFromRaw(f,n,k.getRawValueFromClient),this.entityManager._checkStateChange(f,o,t.isUnchanged()));return f}return this._emptyIndexes.length===0?u=this._entities.push(n)-1:(u=this._emptyIndexes.pop(),this._entities[u]=n),this._indexMap[e]=u,r.entityState=t,r.entityGroup=this,r.entityManager=this.entityManager,n},n.detachEntity=function(n){var r=n.entityAspect,i=r.getKey()._keyInGroup,t=this._indexMap[i];if(t===undefined)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[i],this._emptyIndexes.push(t),this._entities[t]=null,n},n.findEntityByKey=function(n){var i,t;return i=n instanceof o?n._keyInGroup:o.createKeyString(n),t=this._indexMap[i],t!==undefined?this._entities[t]:null},n.hasChanges=function(){return this._entities.some(r)},n.getEntities=function(n){var t=i(n);return this._entities.filter(t)},n._clear=function(){this._entities.forEach(function(n){n!=null&&n.entityAspect._detach()});this._entities=null;this._indexMap=null;this._emptyIndexes=null},n._fixupKey=function(n,t){var r=this._indexMap[n],i,u;if(r===undefined)throw new Error("Internal Error in key fixup - unable to locate entity");i=this._entities[r];u=i.entityType.keyProperties[0].name;i.setProperty(u,t);delete i.entityAspect.hasTempKey;delete this._indexMap[n];this._indexMap[t]=r},n._replaceKey=function(n,t){var i=this._indexMap[n._keyInGroup];delete this._indexMap[n._keyInGroup];this._indexMap[t._keyInGroup]=i},t}(),pr=function(){function vt(n,t,i){var u=i?ut.defaultInstance:n.queryOptions,f=i?wt.defaultInstance:n.saveOptions,e=i?ii.defaultInstance:n.validationOptions,r=s(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(c).whereParam("queryOptions").isInstanceOf(ut).isOptional().withDefault(u).whereParam("saveOptions").isInstanceOf(wt).isOptional().withDefault(f).whereParam("validationOptions").isInstanceOf(ii).isOptional().withDefault(e).whereParam("keyGeneratorCtor").isFunction().isOptional();i&&(r=r.whereParam("metadataStore").isInstanceOf(yt).isOptional().withDefault(new yt));r.applyAll(n);wi(n.queryOptions,u);wi(n.saveOptions,f);wi(n.validationOptions,e);t.serviceName&&(n.dataService=new c({serviceName:n.serviceName}));n.serviceName=n.dataService&&n.dataService.serviceName;n.keyGeneratorCtor=n.keyGeneratorCtor||ar;(i||t.keyGeneratorCtor)&&(n.keyGenerator=new n.keyGeneratorCtor)}function oi(n){n.forEach(function(n){var t=[],i=n.entityAspect._validationErrors;(it(i,function(n,i){i.isServerError&&t.push(n)}),t.length!==0)&&(t.forEach(function(n){delete i[n]}),n.hasValidationErrors=!ft(i))})}function si(n){var t=[];return n.forEach(function(n){it(n.entityAspect._validationErrors,function(i,r){var u=h({entity:n,errorName:r.validator.name},r,["errorMessage","propertyName","isServerError"]);t.push(u)})}),t}function hi(n,t){var r=t.entityErrors,i,u;r&&(i=n.entityManager,u=i.metadataStore,t.entityErrors=r.map(function(n){var t=null,r,f;if(n.keyValues&&(r=u._getEntityType(n.entityTypeName),f=new o(r,n.keyValues),t=i.findEntityByKey(f)),t){var s=n.propertyName?{propertyName:n.propertyName,property:r.getProperty(n.propertyName)}:{},c=ht.getKey(n.errorName||n.errorMessage,n.propertyName),e=new ht(null,s,n.errorMessage,c);e.isServerError=!0;t.entityAspect.addValidationError(e)}return h({entity:t,isServerError:!0},n,["errorName","errorMessage","propertyName"])}))}function ci(n,t){if(n.length!==t.length)return!1;for(var i=0,r=n.length;i<r;i++)if(n[i]!==t[i])return!1;return!0}function p(t,i){return n(i,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(l).or().isNonEmptyArray().isInstanceOf(l).check(),typeof i=="string"?i=t.metadataStore._getEntityType(i,!1):Array.isArray(i)&&typeof i[0]=="string"&&(i=i.map(function(n){return t.metadataStore._getEntityType(n,!1)})),i}function w(n,t,i){var u=ti(n,t),r;return u.forEach(function(n){if(n){var t=n.getEntities(i);r?r.push.apply(r,t):r=t}}),r||[]}function pt(n,t){if(t[0]instanceof o)return{entityKey:t[0],remainingArgs:d(t,1)};if(typeof t[0]=="string"&&t.length>=2){var i=n.metadataStore._getEntityType(t[0],!1);return{entityKey:new o(i,t[1]),remainingArgs:d(t,2)}}throw new Error("This method requires as its initial parameters either an EntityKey or an entityType name followed by a value or an array of values.");}function bt(n,t){n.forEach(function(n){n.entityAspect.isBeingSaved=t})}function li(n,t){var i,r,u;return t?(i={},t.forEach(function(n){var t=i[n.entityType.name];t||(t={},t.entityType=n.entityType,t._entities=[],i[n.entityType.name]=t);t._entities.push(n)})):i=n._entityGroupMap,r=[],u={},it(i,function(n,t){u[n]=ai(t,r)}),{entityGroupMap:u,tempKeys:r}}function ai(n,t){var i={},r=n.entityType,f=r.dataProperties,e=at(r),u=[];return n._entities.forEach(function(n){if(n){var i=kt(n,f,e,t);u.push(i)}}),i.entities=u,i}function kt(n,t,i,r){var e={},u,f,o;return t.forEach(function(t){var u=t.name,r=n.getProperty(u),f;(r!=null||t.defaultValue!=null)&&(r&&t.isComplexProperty?(f=t.dataType.dataProperties,r=bi(r,function(n){return kt(n,f,i)})):(r=i?i(t,r):r,t.isUnmapped&&(r=dt(r))),r!==undefined)&&(e[u]=r)}),n.entityAspect?(u=n.entityAspect,o=u.entityState,f={tempNavPropNames:vi(u,r),entityState:o.name},(o.isModified()||o.isDeleted())&&(f.originalValuesMap=u.originalValues),e.entityAspect=f):(u=n.complexAspect,f={},u.originalValues&&!ft(u.originalValues)&&(f.originalValuesMap=u.originalValues),e.complexAspect=f),e}function vi(n,t){var r=n.entity,i;return n.hasTempKey&&t.push(n.getKey().toJSON()),r.entityType.navigationProperties.forEach(function(n){if(n.relatedDataProperties){var t=r.getProperty(n.name);t&&t.entityAspect.hasTempKey&&(i=i||[],i.push(n.name))}}),i}function yi(n,t,i){var c=i.tempKeyMap,f=n.entityType,e=i.mergeStrategy,r=null,s=n.entityManager,l=s.entityChanged,v=[],h=k.getRawValueFromClient;return t.entities.forEach(function(t){var w=t.entityAspect,y=f.getEntityKeyFromRawEntity(t,h),i=u.fromName(w.entityState),p,b;if(i.isAdded()?(p=c[y.toString()],r=p===undefined?n.findEntityByKey(y):null):r=n.findEntityByKey(y),r){if(e!==a.SkipMerge)if(e===a.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+y.toString()+" from being merged");else b=r.entityAspect.entityState.isUnchanged(),(e===a.OverwriteChanges||b)&&(f._updateTargetFromRaw(r,t,h),r.entityAspect.entityState=i,l.publish({entityAction:g.MergeOnImport,entity:r}),s._checkStateChange(r,b,i.isUnchanged()))}else r=f._createInstanceCore(),f._updateTargetFromRaw(r,t,h),p!==undefined&&(r.setProperty(f.keyProperties[0].name,p.values[0]),w.tempNavPropNames&&w.tempNavPropNames.forEach(function(n){var t=f.getNavigationProperty(n),i=t.relatedDataProperties[0].name,u=r.getProperty(i),e=new o(t.entityType,[u]),s=c[e.toString()];r.setProperty(i,s.values[0])})),r=n.attachEntity(r,i),l.publish({entityAction:g.AttachOnImport,entity:r}),i.isUnchanged()||s._notifyStateChange(r,!0);v.push(r)}),v}function ni(n,t,i){return n.then(function(n){return t&&t(n),f.resolve(n)},function(n){return i&&i(n),f.reject(n)})}function pi(n,t){return t?t.filter(function(t){if(t.entityAspect.entityManager!==n)throw new Error("Only entities in this entityManager may be saved");return!t.entityAspect.entityState.isDetached()}):n.getChanges()}function gi(n,t){n._inKeyFixup=!0;t.forEach(function(t){var i=n._entityGroupMap[t.entityTypeName];if(!i)throw new Error("Unable to locate the following fully qualified EntityType name: "+t.entityTypeName);i._fixupKey(t.tempValue,t.realValue)});n._inKeyFixup=!1}function ti(n,t){var i=n._entityGroupMap;return t?b(t).map(function(n){if(n instanceof l)return i[n.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null");}):kr(i)}function nr(n,t){var i=t.entityAspect.getKey(),r=ki(t.entityType.keyProperties,i.values,function(n,t){return n.defaultValue===t?n:null}).filter(function(n){return n!==null});if(r.length)if(t.entityType.autoGeneratedKeyType!==st.None)n.generateTempKeyValue(t);else if(r.length===i.values.length)throw new Error("Cannot attach an object to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'");}function tr(n,t){return t?(t=b(t),t.forEach(function(n){if(!u.contains(n))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates");}),t):null}function ir(n,t,i,r){var u=t.entityType.navigationProperties;u.forEach(function(u){var f=t.getProperty(u.name);if(u.isScalar){if(!f)return;n.attachEntity(f,i,r)}else f.forEach(function(t){n.attachEntity(t,i,r)})})}function ui(n,t,i,r){var o,s,u,h;try{if(o=n.metadataStore,o.isEmpty()&&r.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(i.fetchStrategy===ri.FromLocalCache)try{return s=n.executeQueryLocally(t),f.resolve({results:s,query:t})}catch(e){return f.reject(e)}return u=new wr({query:t,entityManager:n,dataService:r,mergeOptions:{mergeStrategy:i.mergeStrategy,noTracking:!!t.noTrackingEnabled}}),h=n.validationOptions.validateOnQuery,r.adapterInstance.executeQuery(u).then(function(i){var e=gr(function(){var t={isLoading:n.isLoading};return n.isLoading=!0,n._pendingPubs=[],t},function(i){n.isLoading=i.isLoading;n._pendingPubs.forEach(function(n){n()});n._pendingPubs=null;t=null;u=null;i.error&&f.reject(i.error)},function(){var f=r.jsonResultsAdapter.extractResults(i),e;return f=b(f),e=u.visitAndMerge(f,{nodeType:"root"}),h&&e.forEach(function(n){n.entityAspect&&n.entityAspect.validateEntity()}),u.processDeferred(),{results:e,query:t,entityManager:n,httpResponse:i.httpResponse,inlineCount:i.inlineCount}});return f.resolve(e)},function(i){return i&&(i.query=t,i.entityManager=n),f.reject(i)})}catch(e){return e&&(e.query=t),f.reject(e)}}function rr(n){var t=n.filter(function(n){return n.entityAspect.isBeingSaved=!0,n.entityAspect.entityState.isModified()&&n.entityType.concurrencyProperties.length>0});t.length!==0&&t.forEach(function(n){n.entityType.concurrencyProperties.forEach(function(t){ur(n,t)})})}function ur(n,t){var r,f,u;if(!n.entityAspect.originalValues[t.name])if(r=n.getProperty(t.name),r||(r=t.dataType.defaultValue),t.dataType.isNumeric)n.setProperty(t.name,r+1);else if(t.dataType.isDate){for(f=new Date,u=new Date;f.getTime()===u.getTime();)u=new Date;n.setProperty(t.name,u)}else if(t.dataType===i.Guid)n.setProperty(t.name,fi());else{if(t.dataType===i.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+t.name);}}function et(n,t){var i=n._entityGroupMap[t.name];return i||(i=new ou(n,t),n._entityGroupMap[t.name]=i),i}function fr(n,t){var i=t.getSelfAndSubtypes();return i.map(function(t){return et(n,t)})}function ei(n,t){var i={},u=n.entityType||n.complexType,f=at(u),r={};return u.dataProperties.forEach(function(u){if(u.isComplexProperty)i[u.nameOnServer]=bi(n.getProperty(u.name),function(n){return ei(n,t)});else{var e=n.getProperty(u.name);if(e=t?t(u,e):e,e===undefined)return;e=f?f(u,e):e;e!==undefined&&(u.isUnmapped?r[u.name]=dt(e):i[u.nameOnServer]=e)}}),ft(r)||(i.__unmapped=r),i}function ct(n,t,i){var f=n.entityType||n.complexType,e=n.entityAspect||n.complexAspect,u=t.namingConvention.clientPropertyNameToServer,r={};return it(e.originalValues,function(n,t){var e=f.getProperty(n);t=i?i(e,t):t;t!==undefined&&(r[u(n,e)]=t)}),f.complexProperties.forEach(function(f){var o=n.getProperty(f.name),e,s;f.isScalar?(e=ct(o,t,i),ft(e)||(r[u(f.name,f)]=e)):(s=o.map(function(n){return ct(n,t,i)}),r[u(f.name,f)]=s)}),r}function lt(n,t,i){var u=n.entityType||n.complexType,e=at(u),o=n.entityAspect||n.complexAspect,f=t.namingConvention.clientPropertyNameToServer,r={};return it(o.originalValues,function(t){var s=u.getProperty(t),o=n.getProperty(t);(o=i?i(s,o):o,o!==undefined)&&(o=e?e(dp,o):o,o!==undefined&&(r[f(t,s)]=o))}),u.complexProperties.forEach(function(u){var o=n.getProperty(u.name),e,s;u.isScalar?(e=lt(o,t,i),ft(e)||(r[f(u.name,u)]=e)):(s=o.map(function(n){return lt(n,t,i)}),r[f(u.name,u)]=s)}),r}function at(n){return n.serializerFn||n.metadataStore&&n.metadataStore.serializerFn}function e(){this.map={}}var v=function(n){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");arguments.length===0?n={serviceName:""}:typeof n=="string"&&(n={serviceName:n});vt(this,n,!0);this.entityChanged=new tt("entityChanged",this);this.validationErrorsChanged=new tt("validationErrorsChanged",this);this.hasChangesChanged=new tt("hasChangesChanged",this);this.clear()},r=v.prototype;return r._$typeName="EntityManager",tt.bubbleEvent(r,null),r.setProperties=function(n){vt(this,n,!1)},r.createEntity=function(t,i,r,f){n(t,"entityType").isString().or().isInstanceOf(l).check();n(r,"entityState").isEnumOf(u).isOptional().check();n(f,"mergeStrategy").isEnumOf(a).isOptional().check();typeof t=="string"&&(t=this.metadataStore._getEntityType(t));r=r||u.Added;var e;return gt(this,"isLoading",!0,function(){e=t.createEntity(i)}),r!==u.Detached&&(e=this.attachEntity(e,r,f)),e},v.importEntities=function(n,t){var i=new pr;return i.importEntities(n,t),i},r.acceptChanges=function(){this.getChanges().forEach(function(n){n.entityAspect.acceptChanges()})},r.rejectChanges=function(){this.getChanges().forEach(function(n){n.entityAspect.rejectChanges()})},r.exportEntities=function(i,r){var f,u;return n(r,"includeMetadata").isBoolean().isOptional().check(),r=r==null?!0:r,f=li(this,i),u=h({},f,["tempKeys","entityGroupMap"]),r?(u=h(u,this,["dataService","saveOptions","queryOptions","validationOptions"]),u.metadataStore=this.metadataStore.exportMetadata()):(u.metadataVersion=t.metadataVersion,u.metadataStoreName=this.metadataStore.name),JSON.stringify(u,null,y.stringifyPad)},r.importEntities=function(n,t){var r,i,u,f;return t=t||{},s(t).whereParam("mergeStrategy").isEnumOf(a).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(t),r=this,i=typeof n=="string"?JSON.parse(n):n,i.metadataStore?(this.metadataStore.importMetadata(i.metadataStore),this.dataService=i.dataService&&c.fromJSON(i.dataService)||new c({serviceName:i.serviceName}),this.saveOptions=new wt(i.saveOptions),this.queryOptions=ut.fromJSON(i.queryOptions),this.validationOptions=new ii(i.validationOptions)):t.metadataVersionFn&&t.metadataVersionFn({metadataVersion:i.metadataVersion,metadataStoreName:i.metadataStoreName}),u={},i.tempKeys.forEach(function(n){var t=o.fromJSON(n,r.metadataStore);u[t.toString()]=new o(t.entityType,r.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))}),f=[],t.tempKeyMap=u,gr(function(){r._pendingPubs=[]},function(){r._pendingPubs.forEach(function(n){n()});r._pendingPubs=null},function(){it(i.entityGroupMap,function(n,i){var u=r.metadataStore._getEntityType(n,!0),e=et(r,u),o=yi(e,i,t);Array.prototype.push.apply(f,o)});f.forEach(function(n){r._linkRelatedEntities(n)})}),{entities:f,tempKeyMapping:u}},r.clear=function(){it(this._entityGroupMap,function(n,t){t._clear()});this._entityGroupMap={};this._unattachedChildrenMap=new e;this.keyGenerator=new this.keyGeneratorCtor;this.entityChanged.publish({entityAction:g.Clear});this._hasChanges&&(this._hasChanges=!1,this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},r.createEmptyCopy=function(){return new v(h({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]))},r.addEntity=function(n){return this.attachEntity(n,u.Added)},r.attachEntity=function(t,i,r){var f,s,o,e;if(n(t,"entity").isRequired().check(),this.metadataStore._checkEntityType(t),i=n(i,"entityState").isEnumOf(u).isOptional().check(u.Unchanged),r=n(r,"mergeStrategy").isEnumOf(a).isOptional().check(a.Disallowed),t.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");if(f=t.entityAspect,f){if(f._inProcessEntity)return f._inProcessEntity}else f=new ot(t);if(s=f.entityManager,s){if(s===this)return t;throw new Error("This entity already belongs to another EntityManager");}return o=this,gt(this,"isLoading",!0,function(){i.isAdded()&&nr(o,t);e=o._attachEntityCore(t,i,r);f._inProcessEntity=e;try{ir(o,t,i,r)}finally{f._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&e.entityAspect.validateEntity(),i.isUnchanged()||this._notifyStateChange(e,!0),this.entityChanged.publish({entityAction:g.Attach,entity:e}),e},r.detachEntity=function(t){n(t,"entity").isEntity().check();var i=t.entityAspect;if(!i)return!1;if(i.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return i.setDetached()},r.fetchMetadata=function(t,i,r){typeof t=="function"?(r=i,i=t,t=null):(n(t,"dataService").isInstanceOf(c).isOptional().check(),n(i,"callback").isFunction().isOptional().check(),n(r,"errorCallback").isFunction().isOptional().check());var u=this.metadataStore.fetchMetadata(t||this.dataService);return ni(u,i,r)},r.executeQuery=function(t,i,r){var f,e,u,o;return n(t,"query").isInstanceOf(rt).or().isString().check(),n(i,"callback").isFunction().isOptional().check(),n(r,"errorCallback").isFunction().isOptional().check(),e=ut.resolve([t.queryOptions,this.queryOptions,ut.defaultInstance]),u=c.resolve([t.dataService,this.dataService]),!u.hasServerMetadata||this.metadataStore.hasMetadataFor(u.serviceName)?f=ui(this,t,e,u):(o=this,f=this.fetchMetadata(u).then(function(){return ui(o,t,e,u)})),ni(f,i,r)},r.executeQueryLocally=function(t){var h,i,u,f,e,o,c;n(t,"query").isInstanceOf(rt).check();var l=this.metadataStore,r=t._getFromEntityType(l,!0),a=fr(this,r),s=t._toFilterFunction(r);return h=s?function(n){return n&&!n.entityAspect.entityState.isDeleted()&&s(n)}:function(n){return n&&!n.entityAspect.entityState.isDeleted()},i=[],a.forEach(function(n){i.push.apply(i,n._entities.filter(h))}),u=t._toOrderByComparer(r),u&&i.sort(u),f=t.skipCount,f&&(i=i.slice(f)),e=t.takeCount,e&&(i=i.slice(0,e)),o=t.selectClause,o&&(c=o.toFunction(),i=i.map(function(n){return c(n)})),i},r.saveChanges=function(t,i,r,u){var p,e,h,w,l,v,s;if(n(t,"entities").isOptional().isArray().isEntity().check(),n(i,"saveOptions").isInstanceOf(wt).isOptional().check(),n(r,"callback").isFunction().isOptional().check(),n(u,"errorCallback").isFunction().isOptional().check(),i=i||this.saveOptions||wt.defaultInstance,p=t==null,e=pi(this,t),e.length===0)return h={entities:[],keyMappings:[]},r&&r(h),f.resolve(h);if(!i.allowConcurrentSaves&&(w=e.some(function(n){return n.entityAspect.isBeingSaved}),w))return l=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false"),u&&u(l),f.reject(l);if(oi(e),this.validationOptions.validateOnSave&&(v=e.filter(function(n){var t=n.entityAspect,i=t.entityState.isDeleted()||t.validateEntity();return!i}),v.length>0))return s=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail"),s.entityErrors=si(v),u&&u(s),f.reject(s);rr(e);var y=c.resolve([i.dataService,this.dataService]),b={entityManager:this,dataService:y,resourceName:i.resourceName||this.saveOptions.resourceName||"SaveChanges"},k={entities:e,saveOptions:i},o=this;return y.adapterInstance.saveChanges(b,k).then(function(n){gi(o,n.keyMappings);var i=new wr({query:null,entityManager:o,mergeOptions:{mergeStrategy:a.OverwriteChanges},dataService:y}),t=i.visitAndMerge(n.entities,{nodeType:"root"});return bt(e,!1),o._hasChanges=p&&ci(e,t)?!1:o._hasChangesCore(),o._hasChanges||o.hasChangesChanged.publish({entityManager:o,hasChanges:!1}),n.entities=t,r&&r(n),f.resolve(n)},function(n){return hi(b,n),bt(e,!1),u&&u(n),f.reject(n)})},r._findEntityGroup=function(n){return this._entityGroupMap[n.name]},r.getEntityByKey=function(){var t=pt(this,arguments).entityKey,n,r=t._subtypes,i,f,u;if(r){for(i=0,f=r.length;i<f;i++)if(n=this._findEntityGroup(r[i]),u=n&&n.findEntityByKey(t),u)return u}else return n=this._findEntityGroup(t.entityType),n&&n.findEntityByKey(t)},r.fetchEntityByKey=function(){var r=pt(this,arguments),t=r.entityKey,u=r.remainingArgs.length===0?!1:!!r.remainingArgs[0],n,i=!1;return u&&(n=this.getEntityByKey(t),i=n&&n.entityAspect.entityState.isDeleted(),i&&(n=null,this.queryOptions.mergeStrategy===a.OverwriteChanges&&(i=!1))),n||i?f.resolve({entity:n,entityKey:t,fromCache:!0}):rt.fromEntityKey(t).using(this).execute().then(function(i){return n=i.results.length===0?null:i.results[0],f.resolve({entity:n,entityKey:t,fromCache:!1})})},r.findEntityByKey=function(n){return this.getEntityByKey(n)},r.generateTempKeyValue=function(t){n(t,"entity").isEntity().check();var i=t.entityType,r=this.keyGenerator.generateTempKeyValue(i),u=i.keyProperties[0];return t.setProperty(u.name,r),t.entityAspect.hasTempKey=!0,r},r.hasChanges=function(n){return this._hasChanges?n===undefined?this._hasChanges:this._hasChangesCore(n):!1},r._hasChangesCore=function(n){n=p(this,n);var t=ti(this,n);return t.some(function(n){return n.hasChanges()})},r.getChanges=function(n){n=p(this,n);var t=[u.Added,u.Modified,u.Deleted];return w(this,n,t)},r.rejectChanges=function(){if(!this._hasChanges)return[];var t=[u.Added,u.Modified,u.Deleted],n=w(this,null,t);return this._hasChanges=!1,n.forEach(function(n){n.entityAspect.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),n},r.getEntities=function(t,i){return t=p(this,t),n(i,"entityStates").isOptional().isEnumOf(u).or().isNonEmptyArray().isEnumOf(u).check(),i&&(i=tr(this,i)),w(this,t,i)},r._checkStateChange=function(n,t,i){t?i||this._notifyStateChange(n,!0):i&&this._notifyStateChange(n,!1)},r._notifyStateChange=function(n,t){this.entityChanged.publish({entityAction:g.EntityStateChange,entity:n});t?this._hasChanges||(this._hasChanges=!0,this.hasChangesChanged.publish({entityManager:this,hasChanges:!0})):this._hasChanges&&(this._hasChanges=this._hasChangesCore(),this._hasChanges||this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},r._linkRelatedEntities=function(n){var t=this,i=n.entityAspect;gt(t,"isLoading",!0,function(){var r=t._unattachedChildrenMap,f=i.getKey(),e=r.getTuples(f);e&&e.forEach(function(t){var s=t.children.filter(function(n){return n.entityAspect.entityState!==u.Detached}),e,i,o=t.navigationProperty,c,h;o.inverse?(e=o,i=o.inverse,i.isScalar?(c=s[0],n.setProperty(i.name,c),c.setProperty(e.name,n)):(h=n.getProperty(i.name),s.forEach(function(t){h.push(t);t.setProperty(e.name,n)}))):o.parentType===n.entityType?(i=o,i.isScalar?n.setProperty(i.name,s[0]):(h=n.getProperty(i.name),s.forEach(function(n){h._push(n)}))):(e=o,s.forEach(function(t){t.setProperty(e.name,n)}));r.removeChildren(f,e)});n.entityType.navigationProperties.forEach(function(u){var o,f,e;if((!u.isScalar||(o=n.getProperty(u.name),!o))&&(f=i.getParentKey(u),f)){if(f._isEmpty())return;e=t.findEntityByKey(f);e?n.setProperty(u.name,e):r.addChild(f,u,n)}});n.entityType.foreignKeyProperties.forEach(function(i){var u=i.inverseNavigationProperty;if(u){var s=n.getProperty(i.name),e=new o(u.parentType,[s]),f=t.findEntityByKey(e);f?u.isScalar?f.setProperty(u.name,n):t.isLoading?f.getProperty(u.name)._push(n):f.getProperty(u.name).push(n):r.addChild(e,u,n)}})})},r._attachEntityCore=function(n,t,i){var u=et(this,n.entityType),r=u.attachEntity(n,t,i);return this._linkRelatedEntities(r),r},r.helper={unwrapInstance:ei,unwrapOriginalValues:ct,unwrapChangedValues:lt},e.prototype.addChild=function(n,t,i){var r=this.getTuple(n,t);r||(r={navigationProperty:t,children:[]},di(this.map,n.toString()).push(r));r.children.push(i)},e.prototype.removeChildren=function(n,t){var i=this.map[n.toString()];i&&(or(i,function(n){return n.navigationProperty===t}),i.length||delete this.map[n.toString()])},e.prototype.getChildren=function(n,t){var i=this.getTuple(n,t);return i?i.children.filter(function(n){return!n.entityAspect.entityState.isDetached()}):null},e.prototype.getTuple=function(n,t){var i=this.map[n.toString()];return i?nt(i,function(n){return n.navigationProperty===t}):null},e.prototype.getTuples=function(n){return this.map[n.toString()]},v}(),t.EntityManager=pr,wr=function(){function t(n,t,i,u){var e,f;return i.ignore||t==null?null:i.nodeRefId?(e=d(n,i.nodeRefId),typeof e=="function"&&u!=null)?(n.deferredFns.push(function(){u(e)}),undefined):e:i.entityType?(f=i.entityType,n.mergeOptions.noTracking?(t=r(n,f,t),f.noTrackingFn&&(t=f.noTrackingFn(t,f)),i.nodeId&&(n.refMap[i.nodeId]=t),t):f.isComplexType?r(n,f,t):nt(n,t,i)):(typeof t!="object"||at(t)||(t=b(n,t)),i.nodeId&&(n.refMap[i.nodeId]=t),t)}function r(n,t,i){var u={};return t.dataProperties.forEach(function(t){u[t.name]=t.isComplexProperty?bi(i[t.nameOnServer],function(i){return r(n,t.dataType,i)}):w(i[t.nameOnServer],t.dataType)}),t.navigationProperties&&t.navigationProperties.forEach(function(t){var r={nodeType:"navProp",navigationProperty:t};e(i[t.nameOnServer],n,r,u,t.name)}),u}function b(n,t){var r=n.metadataStore.namingConvention.serverPropertyNameToClient,i={};return it(t,function(t,u){var f=r(t),o={nodeType:"anonProp",propertyName:f};e(u,n,o,i,f)}),i}function e(n,i,r,u,f){var o=i.jsonResultsAdapter,e=o.visitNode(n,i,r)||{};(n=e.node||n,e.ignore)||(Array.isArray(n)?(r.nodeType=r.nodeType+"Item",u[f]=n.map(function(n,s){return e=o.visitNode(n,i,r)||{},n=e.node||n,t(i,n,e,function(n){u[f][s]=n()})})):u[f]=t(i,n,e,function(n){u[f]=n()}))}function d(n,t){var i=n.refMap[t];return i===undefined?function(){return n.refMap[t]}:i}function o(n,t,i){var r=i._$meta.nodeId;r!=null&&(n.refMap[r]=t)}function nt(n,t,i){var f,e,h,y;t._$meta=i;f=n.entityManager;e=i.entityType;typeof e=="string"&&(e=n.metadataStore._getEntityType(e,!1));t.entityType=e;var o=n.mergeOptions.mergeStrategy,l=n.query==null,v=e.getEntityKeyFromRawEntity(t,n.rawValueFn),r=f.findEntityByKey(v);if(r){if(l&&r.entityAspect.entityState.isDeleted())return f.detachEntity(r),r;if(h=r.entityAspect.entityState,o===a.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+v.toString()+" from being merged");else o===a.SkipMerge?s(n,r,t):o===a.OverwriteChanges||h.isUnchanged()?(c(n,r,t),r.entityAspect.wasLoaded=!0,i.extra&&(r.entityAspect.extraMetadata=i.extra),r.entityAspect.entityState=u.Unchanged,r.entityAspect.originalValues={},r.entityAspect.propertyChanged.publish({entity:r,propertyName:null}),y=l?g.MergeOnSave:g.MergeOnQuery,f.entityChanged.publish({entityAction:y,entity:r}),h.isUnchanged||f._notifyStateChange(r,!1)):s(n,r,t)}else r=e._createInstanceCore(),c(n,r,t),i.extra&&(r.entityAspect.extraMetadata=i.extra),f._attachEntityCore(r,u.Unchanged,a.Disallowed),r.entityAspect.wasLoaded=!0,f.entityChanged.publish({entityAction:g.AttachOnQuery,entity:r});return r}function s(n,t,i){o(n,t,i);i.entityType.navigationProperties.forEach(function(t){t.isScalar?l(n,i,t):v(n,i,t)})}function c(n,t,i){o(n,t,i);var r=t.entityType;r._updateTargetFromRaw(t,i,n.rawValueFn);r.navigationProperties.forEach(function(r){r.isScalar?tt(n,r,t,i):rt(n,r,t,i)})}function tt(n,t,i,r){var u=l(n,r,t);u!=null&&(typeof u=="function"?n.deferredFns.push(function(){u=u();y(u,i,t)}):y(u,i,t))}function rt(n,t,i,r){var e=v(n,r,t),u,f;e!=null&&(u=t.inverse,u)&&(f=i.getProperty(t.name),f.wasLoaded=!0,e.forEach(function(t){typeof t=="function"?n.deferredFns.push(function(){t=t();p(t,f,i,u)}):p(t,f,i,u)}))}function l(n,t,i){var r=t[i.nameOnServer];return r?n.visitAndMerge(r,{nodeType:"navProp",navigationProperty:i}):null}function v(n,t,i){var r=t[i.nameOnServer];return r?!Array.isArray(r)&&(r=r.results,!r)?null:n.visitAndMerge(r,{nodeType:"navPropItem",navigationProperty:i}):null}function y(n,t,i){var u,f,r,e;if(n&&(u=i.name,f=t.getProperty(u),f!==n)){if(t.setProperty(u,n),r=i.inverse,!r)return;r.isScalar?n.setProperty(r.name,t):(e=n.getProperty(r.name),e.push(t))}}function p(n,t,i,r){if(n){var u=n.getProperty(r.name);u!==i&&(t.push(n),n.setProperty(r.name,i))}}var f=function(n){h(this,n,["query","entityManager","dataService","mergeOptions"]);this.refMap={};this.deferredFns=[];this.jsonResultsAdapter=this.dataService.jsonResultsAdapter;this.metadataStore=this.entityManager.metadataStore;this.rawValueFn=k.getRawValueFromServer},n=f.prototype,w=i.parseRawValue;return n._$typeName="MappingContext",n.getUrl=function(){return this.dataService.makeUrl(this.metadataStore.toQueryString(this.query))},n.visitAndMerge=function(n,i){var u=this.query,f=this.jsonResultsAdapter,r;return i=i||{},r=this,bi(n,function(n){if(u==null&&n.entityAspect)return n.entityAspect.entityState.isDeleted()?r.entityManager.detachEntity(n):n.entityAspect.acceptChanges(),n;var e=f.visitNode(n,r,i)||{};return n=e.node||n,u&&i.nodeType==="root"&&!e.entityType&&(e.entityType=u._getToEntityType&&u._getToEntityType(r.metadataStore)),t(r,n,e)})},n.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(n){n()})},f}(),wt=function(){function i(n,t){return t&&s(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(c).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="SaveOptions",t.setAsDefault=function(){return ui(this,n)},t.using=function(n){return i(this,n)},n.defaultInstance=new n({allowConcurrentSaves:!1}),n}(),t.SaveOptions=wt,t.AbstractDataServiceAdapter=function(){function r(n,t,i){var r=u(t);return i&&(r.message=i+"; "+r.message),n.reject(r)}function u(n){var i=new Error,t,r;if(i.httpResponse=n,i.status=n.status,t=n.data,typeof t=="string")try{t=JSON.parse(t)}catch(u){}return t?(r=t.EntityErrors||t.entityErrors||t.Errors||t.errors,r&&n.saveContext?o(i,r,n.saveContext):i.message=e(t)):i.message=n.error&&n.error.toString(),i}function e(n){while(n.InnerException)n=n.InnerException;return n.ExceptionMessage||n.Message||n.toString()}function o(n,t,i){n.message="Server side errors encountered - see the entityErrors collection on this object for more detail";var r=i.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;n.entityErrors=t.map(function(n){return{errorName:n.ErrorName,entityTypeName:yt.normalizeTypeName(n.EntityTypeName),keyValues:n.KeyValues,propertyName:n.PropertyName&&r(n.PropertyName),errorMessage:n.ErrorMessage}})}var i,n=function(){};return n.prototype.checkForRecomposition=function(n){n.interfaceName==="ajax"&&n.isDefault&&this.initialize()},n.prototype.initialize=function(){if(i=t.config.getAdapterInstance("ajax"),!i)throw new Error("Unable to initialize ajax for WebApi.");var n=i.ajax;if(!n)throw new Error("Breeze was unable to find an 'ajax' adapter");},n.prototype.fetchMetadata=function(n,t){var o=t.serviceName,e=t.makeUrl("Metadata"),u=f.defer(),s=this;return i.ajax({type:"GET",url:e,dataType:"json",success:function(i){var f,s,h;if(n.hasMetadataFor(o))return u.resolve("already fetched");f=i.data;try{s=typeof f=="string"?JSON.parse(f):f;n.importMetadata(s)}catch(c){return h="Unable to either parse or import metadata: "+c.message,r(u,i,"Metadata query failed for: "+e+". "+h)}n.hasMetadataFor(o)||n.addDataService(t);u.resolve(s)},error:function(n){r(u,n,"Metadata query failed for: "+e)}}),u.promise},n.prototype.executeQuery=function(n){var t=f.defer(),e=n.getUrl(),o=this,u={type:"GET",url:e,params:n.query.parameters,dataType:"json",success:function(n){var i=n.data,u;try{u=i&&i.Results?{results:i.Results,inlineCount:i.InlineCount,httpResponse:n}:{results:i,httpResponse:n};t.resolve(u)}catch(f){f instanceof Error?t.reject(f):r(n)}},error:function(n){r(t,n)}};return n.dataService.useJsonp&&(u.dataType="jsonp",u.crossDomain=!0),i.ajax(u),t.promise},n.prototype.saveChanges=function(n,t){var u=f.defer();t=this._prepareSaveBundle(t,n);var e=JSON.stringify(t),o=n.dataService.makeUrl(n.resourceName),s=this;return i.ajax({type:"POST",url:o,dataType:"json",contentType:"application/json",data:e,success:function(t){var i=t.data,f,e;t.saveContext=n;f=i.Errors||i.errors;f?r(u,t):(e=s._prepareSaveResult(n,i),u.resolve(e))},error:function(t){t.saveContext=n;r(u,t)}}),u.promise},n.prototype._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle");},n.prototype._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult");},n.prototype.jsonResultsAdapter=new oi({name:"noop",visitNode:function(){return{}}}),n}(),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&define(["breeze"],n)}(function(n){function f(n){var i="",o,r,u,t,e,s;for(u in n)if(t=n[u],t instanceof Array)for(e=0;e<t.length;++e)o=t[e],fullSubName=u+"["+e+"]",r={},r[fullSubName]=o,i+=f(r)+"&";else if(t instanceof Object)for(s in t)o=t[s],fullSubName=u+"["+s+"]",r={},r[fullSubName]=o,i+=f(r)+"&";else t!==undefined&&(i+=encodeURIComponent(u)+"="+encodeURIComponent(t)+"&");return i.length?i.substr(0,i.length-1):i}var t=n.core,i,r,u=function(){this.name="angular";this.defaultSettings={}};u.prototype.initialize=function(){var n=t.requireLib("angular"),u;n&&(u=n.injector(["ng"]),u.invoke(["$http","$rootScope",function(n,t){i=n;r=t}]))};u.prototype.setHttp=function(n){i=n;r=null};u.prototype.ajax=function(n){var u,e,o;if(!i)throw new Error("Unable to locate angular for ajax adapter");u={method:n.type,url:n.url,dataType:n.dataType,contentType:n.contentType,crossDomain:n.crossDomain};n.params&&(e=u.url.indexOf("?")>=0?"&":"?",u.url=u.url+e+f(n.params));n.data&&(u.data=n.data);t.isEmpty(this.defaultSettings)||(o=t.extend({},this.defaultSettings),u=t.extend(o,u));i(u).success(function(t,i,r){t==="null"&&(t=null);var u={data:t,status:i,getHeaders:r,config:n};n.success(u)}).error(function(t,i,r){var u={data:t,status:i,getHeaders:r,config:n};n.error(u)});r&&r.$digest()};n.config.registerAdapter("ajax",u)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&define(["breeze"],n)}(function(n){function u(n){return function(t){return t&&t.length>0?n.getResponseHeader(t):n.getAllResponseHeaders()}}var t=n.core,i,r=function(){this.name="jQuery";this.defaultSettings={}};r.prototype.initialize=function(){i=t.requireLib("jQuery")};r.prototype.ajax=function(n){var r,f;if(!i)throw new Error("Unable to locate jQuery");r={type:n.type,url:n.url,data:n.params||n.data,dataType:n.dataType,contentType:n.contentType,crossDomain:n.crossDomain};t.isEmpty(this.defaultSettings)||(f=t.extend({},this.defaultSettings),r=t.extend(f,r));r.success=function(t,i,r){var f={data:t,status:r.status,getHeaders:u(r),config:n};n.success(f);r.onreadystatechange=null;r.abort=null};r.error=function(t,i,r){var f={data:t.responseText,status:t.status,getHeaders:u(t),error:r,config:n};n.error(f);t.onreadystatechange=null;t.abort=null};i.ajax(r)};n.config.registerAdapter("ajax",r)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&!t&&define(["breeze"],n)}(function(n){function o(n,t){return n.isUnmapped?undefined:(n.dataType===i.DateTimeOffset?t=t&&new Date(t.getTime()-t.getTimezoneOffset()*6e4):n.dataType.quoteJsonOData&&(t=t!=null?t.toString():t),t)}function a(n,t){var r=[],u=[],f=[],e=n.dataService.serviceName,h=n.entityManager,c=h.helper,i=0;return t.entities.forEach(function(n){var l=n.entityAspect,t;if(i=i+1,t={headers:{"Content-ID":i,DataServiceVersion:"2.0"}},f[i]=n,l.entityState.isAdded())t.requestUri=n.entityType.defaultResourceName,t.method="POST",t.data=c.unwrapInstance(n,o),u[i]=l.getKey();else if(l.entityState.isModified())s(t,l,e),t.method="MERGE",t.data=c.unwrapChangedValues(n,h.metadataStore,o);else if(l.entityState.isDeleted())s(t,l,e),t.method="DELETE";else return;r.push(t)}),n.contentKeys=f,n.tempKeys=u,{__batchRequests:[{__changeRequests:r}]}}function s(n,t,i){var r=t.extraMetadata,u=r.uri||r.id;vt(u,i)&&(u=u.substring(i.length));n.requestUri=u;r.etag&&(n.headers["If-Match"]=r.etag)}function u(n,t){var r=new Error,u=n.response,f,i,e;if(r.message=u.statusText,r.statusText=u.statusText,r.status=u.statusCode,t&&(r.url=t),r.body=u.body,u.body)try{i=JSON.parse(u.body);r.body=i;i["odata.error"]&&(i=i["odata.error"]);e="";do f=i.error||i.innererror,f||(e=e+v(i)),f=f||i.internalexception,i=f||i;while(f);e.length>0&&(r.message=e)}catch(o){}return r}function v(n){var t=n.message||"";return(typeof t=="string"?t:t.value)+"; "}var e=n.core,h=n.MetadataStore,c=n.JsonResultsAdapter,l=n.DataProperty,t,r=function(){this.name="OData"};r.prototype.initialize=function(){t=e.requireLib("OData","Needed to support remote OData services");t.jsonHandler.recognizeDates=!0};r.prototype.executeQuery=function(n){var i=f.defer(),r=n.getUrl();return t.read({requestUri:r,headers:{DataServiceVersion:"2.0"}},function(n){var t;return n.__count&&(t=parseInt(n.__count,10)),i.resolve({results:n.results,inlineCount:t})},function(n){return i.reject(u(n,r))}),i.promise};r.prototype.fetchMetadata=function(n,i){var r=f.defer(),o=i.serviceName,e=i.makeUrl("$metadata");return t.read(e,function(t){var f,u;if(!t||!t.dataServices)return f=new Error("Metadata query failed for: "+e),r.reject(f);if(u=t.dataServices,!n.hasMetadataFor(o)){try{n.importMetadata(u)}catch(s){return r.reject(new Error("Metadata query failed for "+e+"; Unable to process returned metadata: "+s.message))}n.addDataService(i)}return r.resolve(u)},function(n){var t=u(n,e);return t.message="Metadata query failed for: "+e+"; "+(t.message||""),r.reject(t)},t.metadataHandler),r.promise};r.prototype.saveChanges=function(n,i){var r=f.defer(),c=n.entityManager.helper,e=n.dataService.makeUrl("$batch"),o=a(n,i),s=n.tempKeys,h=n.contentKeys,v=this;return t.request({headers:{DataServiceVersion:"2.0"},requestUri:e,method:"POST",data:o},function(n){var t=[],i=[],f={entities:t,keyMappings:i};return n.__batchResponses.forEach(function(n){n.__changeResponses.forEach(function(n){var p=n.response||n,v=p.statusCode,a,f,o,c,y;if(!v||v>=400)return r.reject(u(n,e));if(a=n.headers["Content-ID"],f=n.data,f){if(o=s[a],o&&(c=o.entityType,c.autoGeneratedKeyType!==st.None)){var w=o.values[0],b=c.getEntityKeyFromRawEntity(f,l.getRawValueFromServer),k={entityTypeName:c.name,tempValue:w,realValue:b.values[0]};i.push(k)}t.push(f)}else y=h[a],t.push(y)})}),r.resolve(f)},function(n){return r.reject(u(n,e))},t.batchHandler),r.promise};r.prototype.jsonResultsAdapter=new c({name:"OData_default",visitNode:function(n,t,i){var r={},f,u,o;return n==null?r:(n.__metadata!=null&&(f=h.normalizeTypeName(n.__metadata.type),u=f&&t.entityManager.metadataStore.getEntityType(f,!0),u&&u._mappedPropertiesCount<=Object.keys(n).length-1&&(r.entityType=u,r.extra=n.__metadata)),n.results&&(r.node=n.results),o=i.propertyName,r.ignore=n.__deferred!=null||o==="__metadata"||o==="EntityKey"&&n.$type&&e.stringStartsWith(n.$type,"System.Data"),r)}});n.config.registerAdapter("dataService",r)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&!t&&define(["breeze"],n)}(function(n){var f=n.core,i=n.MetadataStore,r=n.JsonResultsAdapter,u=n.AbstractDataServiceAdapter,t=function(){this.name="webApi"};t.prototype=new u;t.prototype._prepareSaveBundle=function(n,t){var i=t.entityManager,u=i.metadataStore,r=i.helper;return n.entities=n.entities.map(function(n){var t=r.unwrapInstance(n),i=null,f;return n.entityType.autoGeneratedKeyType!==st.None&&(i={propertyName:n.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:n.entityType.autoGeneratedKeyType.name}),f=r.unwrapOriginalValues(n,u),t.entityAspect={entityTypeName:n.entityType.name,defaultResourceName:n.entityType.defaultResourceName,entityState:n.entityAspect.entityState.name,originalValuesMap:f,autoGeneratedKey:i},t}),n.saveOptions={tag:n.saveOptions.tag},n};t.prototype._prepareSaveResult=function(n,t){var r=t.KeyMappings.map(function(n){var t=i.normalizeTypeName(n.EntityTypeName);return{entityTypeName:t,tempValue:n.TempValue,realValue:n.RealValue}});return{entities:t.Entities,keyMappings:r,httpResponse:t.httpResponse}};t.prototype.jsonResultsAdapter=new r({name:"webApi_default",visitNode:function(n,t,r){if(n==null)return{};var u=i.normalizeTypeName(n.$type),e=u&&t.entityManager.metadataStore._getEntityType(u,!0),f=r.propertyName,o=f&&f.substr(0,1)==="$";return{entityType:e,nodeId:n.$id,nodeRefId:n.$ref,ignore:o}}});n.config.registerAdapter("dataService",t)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&!t&&define(["breeze"],n)}(function(n){var u=n.core,s=n.ComplexAspect,i,e,t,f,o=Object.prototype.hasOwnProperty,r=function(){this.name="backbone"};r.prototype.initialize=function(){i=u.requireLib("Backbone");e=u.requireLib("_;underscore");t=i.Model.prototype.set;f=i.Model.prototype.get};r.prototype.createCtor=function(t){var r={};return t.dataProperties.forEach(function(n){r[n.name]=n.defaultValue}),i.Model.extend({defaults:r,initialize:function(){if(t.navigationProperties){var r=this;t.navigationProperties.forEach(function(t){if(!t.isScalar){var u=n.makeRelationArray([],r,t);i.Model.prototype.set.call(r,t.name,u)}})}}})};r.prototype.getTrackablePropertyNames=function(n){var t=[];for(var i in n.attributes)t.push(i);return t};r.prototype.initializeEntityPrototype=function(n){n.getProperty=function(n){return this.get(n)};n.setProperty=function(n,t){return this.set(n,t),this};n.set=function(n,i,r){var v=this.entityAspect||this.complexAspect,u,h,s,c,l,a;if(!v)return t.call(this,n,i,r);if(c=this,l=this.entityType||this.complexType,e.isObject(n)||n==null){if(u=n,r=i,!this._validate(u,r))return!1;for(s in u)if(o.call(u,s)){if(h=l.getProperty(s),h==null)throw new Error("Unknown property: "+n);a=function(n){return function(i){return arguments.length===0?f.call(c,n):t.call(c,n,i,r)}}(s);this._$interceptor(h,u[s],a)}}else{if(u={},u[n]=i,r||(r={}),!this._validate(u,r))return!1;if(h=l.getProperty(n),h==null)throw new Error("Unknown property: "+n);s=n;this._$interceptor(h,i,function(n){return arguments.length===0?f.call(c,s):t.call(c,s,n,r)})}return this}};r.prototype.startTracking=function(r){if(!(r instanceof i.Model))throw new Error("This entity is not an Backbone.Model instance");var e=r.entityType||r.complexType,o=r.attributes;e.dataProperties.forEach(function(i){var f=i.name,u=o[f];i.isComplexProperty?u=i.isScalar?i.dataType._createInstanceCore(r,i):n.makeComplexArray([],r,i):i.isScalar?u===undefined&&(u=i.defaultValue):u=n.makePrimitiveArray([],r,i);t.call(r,f,u)});e.navigationProperties&&e.navigationProperties.forEach(function(i){var s,e;if(i.name in o)if(e=f.call(r,i.name),i.isScalar){if(e&&!e.entityType){s=u.formatString("The value of the '%1' property for entityType: '%2' must be either null or another entity",i.name,r.entityType.name);throw new Error(s);}}else if(e){if(!e.parentEntity){s=u.formatString("The value of the '%1' property for entityType: '%2' must be either null or a Breeze relation array",i.name,r.entityType.name);throw new Error(s);}}else e=n.makeRelationArray([],r,i),t.call(r,i.name,e);else i.isScalar?t.call(r,i.name,null):(e=n.makeRelationArray([],r,i),t.call(r,i.name,e))})};n.config.registerAdapter("modelLibrary",r)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&!t&&define(["breeze"],n)}(function(n){function f(n){var i=n.entityType||n.complexType,u=i._extra,t=u.alreadyWrappedProps||{};i.getProperties().forEach(function(i){var u=i.name;t[u]||(u in n?r(n,i):o(n,i),t[u]=!0)});u.alreadyWrappedProps=t}function e(n){var i=u(n),t=Object.getPrototypeOf(n),r=t.entityType||t.complexType;return r.getProperties().forEach(function(t){var i=t.name,r;n.hasOwnProperty(i)&&(r=n[i],delete n[i],n[i]=r)}),i}function o(n,t){var i=t.name,r=n._pendingBackingStores,f;r||(r=[],n._pendingBackingStores=r);f={get:function(){var n=this._backingStore||u(this);return n[i]},set:function(n){var r=this._backingStore||h(this),u=s(r,i);this._$interceptor(t,n,u)},enumerable:!0,configurable:!0};Object.defineProperty(n,i,f)}function s(n,t){return function(){if(arguments.length==0)return n[t];n[t]=arguments[0]}}function r(n,t){var u,i,f,e;if(!n.hasOwnProperty(t.name)){u=Object.getPrototypeOf(n);r(u,t);return}(i=Object.getOwnPropertyDescriptor(n,t.name),i.configurable)&&(i.value||i.set&&(f=function(n){return function(){if(arguments.length==0)return i.get.bind(n)();i.set.bind(n)(arguments[0])}},e={get:function(){return i.get.bind(this)()},set:function(n){this._$interceptor(t,n,f(this))},enumerable:i.enumerable,configurable:!0},Object.defineProperty(n,t.name,e)))}function u(n){var i=Object.getPrototypeOf(n),t;return c(i),t=n._backingStore,t||(t={},n._backingStore=t),t}function h(n){var u=Object.getPrototypeOf(n),t=u._pendingBackingStores,r=i.arrayFirst(t,function(t){return t.entity===n});return r?r.backingStore:(bs={},t.push({entity:n,backingStore:bs}),bs)}function c(n){var t=n._pendingBackingStores;t&&(t.forEach(function(n){n.entity._backingStore=n.backingStore}),t.length=0)}var i=n.core,t=function(){this.name="backingStore"};t.prototype.initialize=function(){};t.prototype.getTrackablePropertyNames=function(n){var r=[],t,u;for(t in n)t!=="entityType"&&t!=="_$typeName"&&t!=="_pendingSets"&&t!=="_backingStore"&&(u=n[t],i.isFunction(u)||r.push(t));return r};t.prototype.initializeEntityPrototype=function(n){n.getProperty=function(n){return this[n]};n.setProperty=function(n,t){return this[n]=t,this};f(n)};t.prototype.startTracking=function(t){var i=e(t),r=t.entityType||t.complexType;r.getProperties().forEach(function(r){var f=r.name,u=t[f];if(r.isDataProperty)r.isComplexProperty?u=r.isScalar?r.dataType._createInstanceCore(t,r):n.makeComplexArray([],t,r):r.isScalar?u===undefined&&(u=r.defaultValue):u=n.makePrimitiveArray([],t,r);else if(r.isNavigationProperty){if(u!==undefined)throw new Error("Cannot assign a navigation property in an entity ctor.: "+r.Name);u=r.isScalar?null:n.makeRelationArray([],t,r)}else throw new Error("unknown property: "+f);i[f]=u})};n.config.registerAdapter("modelLibrary",t)}),function(n){t?n(t):typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("breeze")):typeof define=="function"&&define.amd&&!t&&define(["breeze"],n)}(function(n){function f(){try{return Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(n){return!1}}function e(n){var i=n.entityType||n.complexType,u;es5Descriptors={};i.getProperties().forEach(function(t){propDescr=r(n,t.name);propDescr&&(es5Descriptors[t.name]=propDescr)});ft(es5Descriptors)||(u=i._extra,u.es5Descriptors=es5Descriptors,i._koDummy=t.observable(null))}function r(n,t){if(!f())return null;if(n.hasOwnProperty(t))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(n,t);var i=Object.getPrototypeOf(n);return i?r(i,t):null}function o(t,i,r){if(i.isDataProperty)i.isComplexProperty?r=i.isScalar?i.dataType._createInstanceCore(t,i):n.makeComplexArray([],t,i):i.isScalar?r===undefined&&(r=i.defaultValue):r=n.makePrimitiveArray([],t,i);else if(i.isNavigationProperty){if(r!==undefined)throw new Error("Cannot assign a navigation property in an entity ctor.: "+i.name);r=i.isScalar?null:n.makeRelationArray([],t,i)}else throw new Error("unknown property: "+i.name);return r}function s(n){n._koObj._suppressBreeze=!0}function h(n){var t=n.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}var u=n.core,t,i=function(){this.name="ko"};i.prototype.initialize=function(){t=u.requireLib("ko","The Knockout library");t.extenders.intercept=function(n,i){var r=i.instance,u=i.property;return n.splice?t.computed({read:n}):t.computed({read:n,write:function(t){return r._$interceptor(u,t,n),r}})}};i.prototype.getTrackablePropertyNames=function(n){var f=[],i,e,o;for(i in n)i!=="entityType"&&i!=="_$typeName"&&(e=r(n,i),e&&e.get?f.push(i):(o=n[i],t.isObservable(o)?f.push(i):u.isFunction(o)||f.push(i)));return f};i.prototype.initializeEntityPrototype=function(n){n.getProperty=function(n){return this[n]()};n.setProperty=function(n,t){return this[n](t),this};f()&&e(n)};i.prototype.startTracking=function(n){var i=n.entityType||n.complexType,r=i._extra.es5Descriptors||{};i.getProperties().sort(function(n,t){var i=n.isUnmapped?1:0,r=t.isUnmapped?1:0;return i-r}).forEach(function(u){var c=u.name,e=n[c],l=r[c],f,a,v,y,p;if(l)a=l.get.bind(n),l.set?(v=l.set.bind(n),y=function(n){if(arguments.length===0)return a();v(n)},f=t.computed({read:function(){return i._koDummy(),a()},write:function(t){return n._$interceptor(u,t,y),i._koDummy.valueHasMutated(),n}})):f=t.computed({read:a,write:function(){}});else if(t.isObservable(e)){if(u.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c);f=e}else e=o(n,u,e),f=u.isScalar?t.observable(e):t.observableArray(e);u.isScalar?l?Object.defineProperty(n,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):(p=f.extend({intercept:{instance:n,property:u}}),n[c]=p):(e._koObj=f,f.subscribe(s,null,"beforeChange"),e.arrayChanged.subscribe(h),f.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.");},n[c]=f)})};n.config.registerAdapter("modelLibrary",i)}),t.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery"}),su=hr("ko"),su?t.config.initializeAdapterInstance("modelLibrary","ko"):t.config.initializeAdapterInstance("modelLibrary","backingStore"),this.window&&(this.window.breeze=t),t});
/*
//# sourceMappingURL=breeze.min.js.map
*/